<!DOCTYPE html>
<html lang="hi">
<head>
<meta charset="UTF-8">
<title>Excel Data Lookup (Dropbox, Devanagari Support) тАФ Nakshatra Only</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
<style>
  body{font-family:'Noto Sans Devanagari',Arial,sans-serif;background:#f7f9fc;padding:24px;}
  h2{color:#0a66c2}
  label{font-weight:600}
  input,select,button{padding:8px;margin:6px 0;border-radius:6px;border:1px solid #ccc}
  button{background:#0a66c2;color:#fff;border:none;cursor:pointer}
  button:hover{background:#094f9a}
  #result{background:#fff;padding:16px;margin-top:14px;border-radius:8px;box-shadow:0 6px 18px rgba(0,0,0,0.06)}
  p{margin:6px 0}
  small.debug{color:#666}
</style>
</head>
<body>
<h2>ЁЯУШ Excel Lookup (Dropbox) тАФ Nakshatra Only</h2>

<label>Dropbox Excel рдлрд╝рд╛рдЗрд▓ рдЪреБрдиреЗрдВ:</label><br>
<select id="fileLink">
  <option value="">-- рдлрд╝рд╛рдЗрд▓ рдЪреБрдиреЗрдВ --</option>
  <!-- replace with your actual Dropbox link if needed -->
  <option value="https://dl.dropboxusercontent.com/scl/fi/oid686zwco9djewl2r476/.xlsx?rlkey=n0qnnoei8dtqmvw4ebbxs8rip&st=kqv17s3q">
    рдореБрдЦреНрдп рдбреЗрдЯрд╛ рдлрд╝рд╛рдЗрд▓
  </option>
</select><br>
<button onclick="loadFile()">рдлрд╝рд╛рдЗрд▓ рд▓реЛрдб рдХрд░реЗрдВ</button>

<div id="dateSection" style="display:none;margin-top:12px">
  <label>рджрд┐рдирд╛рдВрдХ рдЪреБрдиреЗрдВ:</label><br>
  <input type="date" id="datePicker" /> <button onclick="searchData()">рдбреЗрдЯрд╛ рдЦреЛрдЬреЗрдВ</button>
</div>

<h3>рдкрд░рд┐рдгрд╛рдо:</h3><div id="result"></div>

<hr>

<div id="govindji" style="background:#fff;padding:14px;border-radius:8px;">
  <p>реереР рд╢реНрд░реАрдЧрдгреЗрд╢рд╛рдп рдирдо:рее</p>
  <p>реерд╢реНрд░реАрд╕реВрд░реНрдпрд╕рд┐рджреНрдзрд╛рдиреНрддреАрдп ЁЯМЮ рдХрд╛рд╢реАрд╕реНрде рдкрдЮреНрдЪрд╛рдЩреНрдЧрее</p>
  <p>* рд╡рд┐рдХреНрд░рдо рд╕рдореНрд╡рдд - реирежреореи "рд╕рд┐рджреНрдзрд╛рд░реНрде рдирд╛рдордХ рд╕рдВрд╡рддреНрд╕рд░"</p>
  <p>* рд╢рдХ рд╕рдореНрд╡рдд - резрепрекрен</p>
  <p>* рдЛрддреБ - рд╢рд░рдж</p>
  <p>* рдорд╛рд╕ рд╡ рдкрдХреНрд╖ тАУ <span id="maas"></span>&nbsp;<span id="paksha"></span></p>
  <p>рд╡рд╛рд░ - <span id="din"></span></p>
  <p>рддрд┐рдерд┐ - <span id="tithi"></span> (<span id="tithyant"></span> рдмрдЬреЗ рддрдХ)</p>
  <p>рдирдХреНрд╖рддреНрд░ - <span id="nakshatra"></span> (<span id="nakshatraant"></span> рдмрдЬреЗ рддрдХ)</p>

  <!-- Rashi spans remain in HTML but are NOT set by this script -->
  <p>- (рдЪрдиреНрджреНрд░рдорд╛ <span id="rashi1"></span>&nbsp;рд░рд╛рд╢рд┐ рдореЗрдВ&nbsp;<span id="rashyant"></span> рдмрдЬреЗ рддрдХ 
    <span id="rashi2line">рддрджреБрдкрд░рд╛рдиреНрдд <span id="rashi2"></span>&nbsp;рд░рд╛рд╢рд┐ рдореЗрдВ</span>)</p>

  <p>рдХрд░рдг рез - <span id="karan"></span> (<span id="karanant1"></span> рдмрдЬреЗ рддрдХ)</p>
  <p>рдХрд░рдг реи - <span id="karan2"></span> (<span id="karanant2"></span> рдмрдЬреЗ рддрдХ)</p>
  <p>рдХрд░рдг рей - <span id="karan3"></span> (рд╕реВрд░реНрдпреЛрджрдпрдкрд░реНрдпрдиреНрдд)</p>

  <p>рдпреЛрдЧ - <span id="yog"></span> (<span id="yogant"></span> рдмрдЬреЗ рддрдХ)</p>
  <p>* рд╕реВрд░реНрдпреЛрджрдп - <span id="suryodaya"></span> рдмрдЬреЗ</p>
  <p>* рд╕реВрд░реНрдпрд╛рд╕реНрдд - <span id="suryast"></span> рдмрдЬреЗ</p>
  <p>* рджрд┐рд╢рд╛рд╢реВрд▓ - <span id="dikshool"></span></p>
  <p>рдЦреНрд░рд┐рд╖реНрдЯреАрдп рд╡рд░реНрд╖рд╛рдиреБрд╕рд╛рд░ рджрд┐рдирд╛рдВрдХ <span id="dinaank"></span> рдИреж</p>
  <p>реерддрдиреНрдореЗрдордирдГ рд╢рд┐рд╡рд╕рдЩреНрдХрд▓реНрдкрдорд╕реНрддреБрее</p>
</div>

<script>
/* ------------------- Helpers ------------------- */
let workbookData = null;

function normalizeDate(v){
  if(v === undefined || v === null || v === "") return "";
  if(!isNaN(v)){
    const base=new Date(Date.UTC(1899,11,30));
    base.setDate(base.getDate()+Number(v));
    return base.toLocaleDateString("en-GB");
  }
  const d=new Date(v);
  if(!isNaN(d)) return d.toLocaleDateString("en-GB");
  return String(v).trim();
}

function excelTimeToHMS(value){
  if(isNaN(value)) return value;
  const totalSec=Math.round(value*24*3600);
  const h=Math.floor(totalSec/3600);
  const m=Math.floor((totalSec%3600)/60);
  const s=totalSec%60;
  return `${h.toString().padStart(2,"0")}:${m.toString().padStart(2,"0")}:${s.toString().padStart(2,"0")}`;
}



/* ------------------- File loading and search ------------------- */
async function loadFile(){
  const link = document.getElementById("fileLink").value.trim();
  const resDiv = document.getElementById("result");
  if(!link){ resDiv.innerHTML = "тЪая╕П рдХреГрдкрдпрд╛ рдлрд╝рд╛рдЗрд▓ рдЪреБрдиреЗрдВ"; return; }
  resDiv.innerHTML = "тП│ рдлрд╝рд╛рдЗрд▓ рд▓реЛрдб рд╣реЛ рд░рд╣реА рд╣реИ...";
  try{
    const resp = await fetch(link);
    if(!resp.ok) throw new Error("fetch failed: " + resp.status);
    const buf = await resp.arrayBuffer();
    const wb = XLSX.read(new Uint8Array(buf), {type:"array"});
    const sheet = wb.Sheets[wb.SheetNames[0]];
    workbookData = XLSX.utils.sheet_to_json(sheet, {header:1, raw:true, defval:""});
    document.getElementById("dateSection").style.display = "block";
    resDiv.innerHTML = "тЬЕ рдлрд╝рд╛рдЗрд▓ рд▓реЛрдб рд╣реЛ рдЧрдИред рджрд┐рдирд╛рдВрдХ рдЪреБрдиреЗрдВред";
  }catch(err){
    console.error(err);
    resDiv.innerHTML = "тЭМ рдлрд╝рд╛рдЗрд▓ рд▓реЛрдб рдирд╣реАрдВ рд╣реЛ рд╕рдХреА: " + (err.message || err);
  }
}

function searchData(){
  if(!workbookData){ document.getElementById("result").innerHTML="тЪая╕П рдкрд╣рд▓реЗ рдлрд╝рд╛рдЗрд▓ рд▓реЛрдб рдХрд░реЗрдВ"; return; }
  const picker = document.getElementById("datePicker");
  if(!picker.value){ document.getElementById("result").innerHTML="тЪая╕П рджрд┐рдирд╛рдВрдХ рдЪреБрдиреЗрдВ"; return; }

  const selDate = new Date(picker.value).toLocaleDateString("en-GB");
  const headers = workbookData[0] || [];
  const row = workbookData.find((r,i) => i>0 && normalizeDate(r[0]) === selDate);
  const resDiv = document.getElementById("result");
  if(!row){ resDiv.innerHTML = "тЭМ "+ selDate + " рдХреЗ рд▓рд┐рдП рдбреЗрдЯрд╛ рдирд╣реАрдВ рдорд┐рд▓рд╛"; return; }

  let out = `<b>рджрд┐рдирд╛рдВрдХ:</b> ${selDate}<br><br>`;
  for(let i=1;i<headers.length;i++){
    const title = headers[i] || ("col"+i);
    let val = row[i];
    if(typeof val === "string" && /^\d{1,2}:\d{2}(:\d{2})?$/.test(val.trim())){}
    else if(val !== "" && !isNaN(val)) {
      const num = parseFloat(val);
      if(num >= 0 && num < 2) val = excelTimeToHMS(num);
    }
    const varName = "col"+i;
    window[varName] = val;
    out += `<b>${title}:</b> <span id="${varName}">${val}</span><br>`;
  }
  resDiv.innerHTML = out;

  // fill govindji spans
  document.getElementById("dinaank").innerText = selDate;
  document.getElementById("maas").innerText = window.col1 || "";
  document.getElementById("din").innerText = window.col2 || "";
  document.getElementById("tithi").innerText = window.col3 || "";
  document.getElementById("tithyant").innerText = window.col4 || "";
  document.getElementById("yog").innerText = window.col5 || "";
  document.getElementById("yogant").innerText = window.col6 || "";
  document.getElementById("karan").innerText = window.col7 || "";
  document.getElementById("karanant1").innerText = window.col8 || "";
 // document.getElementById("karan2").innerText = window.col9 || "";
  document.getElementById("karanant2").innerText = window.col9 || "";
 // document.getElementById("spashtSurya").innerText = window.col12 || "";
  document.getElementById("suryodaya").innerText = window.col10 || "";
  document.getElementById("suryast").innerText = window.col11 || "";
  document.getElementById("rashyant").innerText = window.col13 || "";
  document.getElementById("nakshatraant").innerText = window.col15 || "";

  // day name mapping (if col2 has Sun/Mon etc.)
  const dayMap = { Sun:"рд░рд╡рд┐рд╡рд╛рд░", Mon:"рд╕реЛрдорд╡рд╛рд░", Tue:"рдордЩреНрдЧрд▓рд╡рд╛рд░", Wed:"рдмреБрдзрд╡рд╛рд░", Thu:"рдмреГрд╣рд╕реНрдкрддрд┐рд╡рд╛рд░", Fri:"рд╢реБрдХреНрд░рд╡рд╛рд░", Sat:"рд╢рдирд┐рд╡рд╛рд░" };
  if(window.col2 && dayMap[window.col2]) 
  document.getElementById("din").innerText = dayMap[window.col2];

// dishashool name mapping (if col2 has Sun/Mon etc.)
  const dikshoolMap = { Sun:"рдкрд╢реНрдЪрд┐рдо", Mon:"рдкреВрд░рдм", Tue:"рдЙрддреНрддрд░", Wed:"рдЙрддреНрддрд░", Thu:"рджрдХреНрд╖рд┐рдг", Fri:"рдкрд╢реНрдЪрд┐рдо", Sat:"рдкреВрд░рдм" };
  if(window.col2 && dikshoolMap[window.col2]) 
  document.getElementById("dikshool").innerText = dikshoolMap[window.col2];


  // nakshatra name mapping (if col2 has Sun/Mon etc.)
  const nakshatraMap = { "1-Ashvini": "рдЕрд╢реНрд╡рд┐рдиреА", "2-Bharani": "рднрд░рдгреА", "3-Krittik├д": "рдХреГрддреНрддрд┐рдХрд╛", "5-Mrigshir├д": "рд░реЛрд╣рд┐рдгреА", "6-├Дrdr├д": "рдореГрдЧрд╢рд┐рд░рд╛", "7-Punarvasu": "рдЖрд░реНрджреНрд░рд╛", "8-Pu┼бya": "рдкреБрдирд░реНрд╡рд╕реБ", "9-├Дshle┼б├д": "рдкреБрд╖реНрдп", "10-Magh├д": "рдЕрд╢реНрд▓реЗрд╖рд╛", "11-1Ph├дlguni": "рдордШрд╛", "12-2Ph├дlguni": "рдкреВрд░реНрд╡рд╛рдлрд╛рд▓реНрдЧреБрдиреА", "13-Hasta": "рдЙрддреНрддрд░рд╛рдлрд╛рд▓реНрдЧреБрдиреА", "14-Chitr├д": "рд╣рд╕реНрдд", "15-Sv├дti": "рдЪрд┐рддреНрд░рд╛", "15-Sv├дti": "рд╕реНрд╡рд╛рддреА", "16-Vish├дkh├д": "рд╡рд┐рд╢рд╛рдЦрд╛", "17-Anur├дdh├д": "рдЕрдиреБрд░рд╛рдзрд╛", "18-Jye┼бth├д": "рдЬреНрдпреЗрд╖реНрдард╛", "19-Moola": "рдореБрд▓", "20-1├Д┼б├дdha": "рдкреБрд░реНрд╡рд╛рд╖рд╛рдврд╛", "21-2├Д┼б├дdha": "рдЙрддреНрддрд░рд╖рд╛рдврд╛", "22-Shravana": "рд╢реНрд░рд╡рдг", "23-Dhani┼бth├д": "рдзрдирд┐рд╖реНрдард╛", "24-Shatbhi┼б": "рд╢рддрднрд┐рд╖рд╛", "25-1Bh├дdrpad": "рдкреВрд░реНрд╡рднрд╛рджреНрд░рдкрдж", "26-2Bh├дdrpad": "рдЙрддреНрддрд░рднрд╛рджреНрд░рдкрдж", "27-Revati": "рд░реЗрд╡рддреА" };
  if(window.col16 && nakshatraMap[window.col16]) 
  document.getElementById("nakshatra").innerText = nakshatraMap[window.col16];

  // yog name mapping (if col5 has 01:Vi┼бkambh etc.)
  const yogMap = { "01:Vi┼бkambh": "рд╡рд┐рд╖реНрдХреБрдореНрдн", "02:Preeti": "рдкреНрд░реАрддрд┐", "03:Ayu┼бm├дn": "рдЖрдпреБрд╖реНрдорд╛рди", "04:Saubh├дgy": "рд╕реМрднрд╛рдЧреНрдп", "05:Shobhan": "рд╢реЛрднрди", "06:Atigand": "рдЕрддрд┐рдЧрдгреНрдб", "07:Sukarman": "рд╕реБрдХрд░реНрдорд╛", "08:Dhriti": "рдзреГрддрд┐", "09:Shoola": "рд╢реВрд▓", "10:Ganda": "рдЧрдгреНрдб", "11:Vriddhi": "рд╡реГрджреНрдзрд┐", "12:Dhruva": "рдзреНрд░реБрд╡", "13:Vy├дgh├дt": "рд╡реНрдпрд╛рдШрд╛рдд", "14:Har┼бan": "рд╣рд░реНрд╖рдг", "15:Vajra": "рд╡рдЬреНрд░", "16:Siddhi": "рд╕рд┐рджреНрдзрд┐", "17:Vyatip├дt": "рд╡реНрдпрддреАрдкрд╛рдд", "18:Variy├дn": "рд╡рд░реАрдпрд╛рдиреН", "19:Parigha": "рдкрд░рд┐рдШ", "20:Shiva": "рд╢рд┐рд╡", "21:Siddha": "рд╕рд┐рджреНрдз", "22:S├дdhy": "рд╕рд╛рдзреНрдп", "23:Shubha": "рд╢реБрдн", "24:Shukla": "рд╢реБрдХреНрд▓", "25:Brahma": "рдмреНрд░рд╣реНрдо", "26:Indra": "рдЗрдиреНрджреНрд░", "27:V├жdhrti": "рд╡реИрдзреГрддрд┐"};
  if(window.col5 && yogMap[window.col5]) 
  document.getElementById("yog").innerText = yogMap[window.col5];

 // day name mapping (if col2 has Sun/Mon etc.)
  const karanMap = { "Bava": "рдмрд╡", "B├дlav": "рдмрд╛рд▓рд╡", "Kaulav": "рдХреМрд▓рд╡", "Taitil": "рддреИрддрд┐рд▓", "Gara": "рдЧрд░", "Vanij": "рд╡рдгрд┐рдЬ", "Vi┼бti": "рд╡рд┐рд╖реНрдЯрд┐", "Shakun": "рд╢рдХреБрдирд┐", "Chatu┼б": "рдЪрддреБрд╖реНрдкрд╛рдж", "N├дga": "рдирд╛рдЧ", "Kimstu": "рдХрд┐рд╕реНрддреБрдШреНрди" };
  if(window.col7 && karanMap[window.col7]) 
  document.getElementById("karan").innerText = karanMap[window.col7];
 // find next karan
      const keys = Object.keys(karanMap);
      const currentIndex = keys.indexOf(window.col7);
      const nextIndex = (currentIndex + 1) % keys.length; // wraps to start if last
      const nextKey = keys[nextIndex];
      const nextIndex1 = (currentIndex + 2) % keys.length; // wraps to start if last
      const nextKey1 = keys[nextIndex1];

      document.getElementById("karan2").innerText = karanMap[nextKey];
      document.getElementById("karan3").innerText = karanMap[nextKey1];
    


  // numeric tithi -> name mapping (if applicable)
  if(!isNaN(window.col3) && window.col3 !== "") {
    const t = Number(window.col3);
    const tithiNames = {
      1:"рдкреНрд░рддрд┐рдкрджрд╛",2:"рджреНрд╡рд┐рддреАрдпрд╛",3:"рддреГрддреАрдпрд╛",4:"рдЪрддреБрд░реНрдереА",5:"рдкрдЮреНрдЪрдореА",6:"рд╖рд╖реНрдареА",7:"рд╕рдкреНрддрдореА",
      8:"рдЕрд╖реНрдЯрдореА",9:"рдирд╡рдореА",10:"рджрд╢рдореА",11:"рдПрдХрд╛рджрд╢реА",12:"рджреНрд╡рд╛рджрд╢реА",13:"рддреНрд░рдпреЛрджрд╢реА",14:"рдЪрддреБрд░реНрджрд╢реА",15:"рдкреВрд░реНрдгрд┐рдорд╛",
      16:"рдкреНрд░рддрд┐рдкрджрд╛",17:"рджреНрд╡рд┐рддреАрдпрд╛",18:"рддреГрддреАрдпрд╛",19:"рдЪрддреБрд░реНрдереА",20:"рдкрдЮреНрдЪрдореА",21:"рд╖рд╖реНрдареА",22:"рд╕рдкреНрддрдореА",
      23:"рдЕрд╖реНрдЯрдореА",24:"рдирд╡рдореА",25:"рджрд╢рдореА",26:"рдПрдХрд╛рджрд╢реА",27:"рджреНрд╡рд╛рджрд╢реА",28:"рддреНрд░рдпреЛрджрд╢реА",29:"рдЪрддреБрд░реНрджрд╢реА",30:"рдкреВрд░реНрдгрд┐рдорд╛"
    };
    document.getElementById("tithi").innerText = tithiNames[t] || window.col3;
    document.getElementById("paksha").innerText = (t <= 15 ? "рд╢реБрдХреНрд▓рдкрдХреНрд╖" : "рдХреГрд╖реНрдгрдкрдХреНрд╖");
  }

  // *** ONLY nakshatra mapping (no rashi mapping) ***
 // setNakshatraOnly(window.col16);

  // convert ASCII digits inside govindji to Devanagari (after DOM updated)
  const devanagariDigits = ['реж','рез','реи','рей','рек','рел','рем','рен','рео','реп'];
  function convertToDevanagari(str){ return String(str).replace(/\d/g, d => devanagariDigits[d]); }
  function replaceDigits(node){
    node.childNodes.forEach(n => {
      if(n.nodeType === Node.TEXT_NODE){
        n.textContent = convertToDevanagari(n.textContent);
      } else {
        replaceDigits(n);
      }
    });
  }
  replaceDigits(document.getElementById("govindji"));
}


</script>



<!--


/* ------------------- Nakshatra Map (only) ------------------- */
/* keys are normalized forms; mapping provides Devanagari nakshatra name */
const NAK_MAP = {
  "1-ashvini":"рдЕрд╢реНрд╡рд┐рдиреА","2-bharani":"рднрд░рдгреА","3-krittika":"рдХреГрддреНрддрд┐рдХрд╛","4-rohini":"рд░реЛрд╣рд┐рдгреА",
  "5-mrigshira":"рдореГрдЧрд╢рд┐рд░рд╛","6-ardra":"рдЖрд░реНрджреНрд░рд╛","7-punarvasu":"рдкреБрдирд░реНрд╡рд╕реБ","8-pushya":"рдкреБрд╖реНрдп",
  "9-ashlesha":"рдЕрд╢реНрд▓реЗрд╖рд╛","10-magha":"рдордШрд╛","11-1phalguni":"рдкреВрд░реНрд╡рд╛рдлрд╛рд▓реНрдЧреБрдиреА","12-2phalguni":"рдЙрддреНрддрд░рд╛рдлрд╛рд▓реНрдЧреБрдиреА",
  "13-hasta":"рд╣рд╕реНрдд","14-chitra":"рдЪрд┐рддреНрд░рд╛","15-Sv├дti":"рд╕реНрд╡рд╛рддреА","16-vishakha":"рд╡рд┐рд╢рд╛рдЦрд╛",
  "17-anuradha":"рдЕрдиреБрд░рд╛рдзрд╛","18-jyestha":"рдЬреНрдпреЗрд╖реНрдард╛","19-moola":"рдореВрд▓","20-1ashadha":"рдкреВрд░реНрд╡рд╛рд╖рд╛рдврд╛",
  "21-2ashadha":"рдЙрддреНрддрд░рд╛рд╖рд╛рдврд╛","22-shravana":"рд╢реНрд░рд╡рдг","23-dhanishtha":"рдзрдирд┐рд╖реНрдард╛","24-shatbhish":"рд╢рддрднрд┐рд╖рд╛",
  "25-1bhadrpad":"рдкреВрд░реНрд╡рднрд╛рджреНрд░рдкрдж","26-2bhadrpad":"рдЙрддреНрддрд░рднрд╛рджреНрд░рдкрдж","27-revati":"рд░реЗрд╡рддреА"
};

/* Robust normalization for col16 values */
function normalizeCol16(s){
  if(s === undefined || s === null) return "";
  s = String(s);
  s = s.trim().normalize("NFD").replace(/[\u0300-\u036f]/g, "");
  s = s.toLowerCase();
  s = s.replace(/[\u2010-\u2015\u2212]/g, "-");
  s = s.replace(/\s*-\s*/g, "-").replace(/\s+/g, "");
  s = s.replace(/[^0-9a-z\-]/g,"");
  s = s.replace(/-+/g,"-").replace(/^-|-$/g,"");
  return s;
}

/* Find the nakshatra key тАФ exact or name-only fallback */
function findNakKey(raw){
  const k = normalizeCol16(raw);
  if(!k) return "";
  if(NAK_MAP[k]) return k;
  const nameOnly = k.replace(/^[0-9\-]+/,"");
  if(NAK_MAP[nameOnly]) return nameOnly;
  for(const candidate of Object.keys(NAK_MAP)){
    if(candidate.endsWith("-" + nameOnly) || candidate === nameOnly) return candidate;
  }
  for(const candidate of Object.keys(NAK_MAP)){
    if(nameOnly && candidate.includes(nameOnly)) return candidate;
  }
  return "";
}

/* Set only Nakshatra into DOM (no Rashi mapping) */
function setNakshatraOnly(col16value){
  const key = findNakKey(col16value);
  console.log("DEBUG: col16 raw:", col16value, "тЖТ key:", key);
  const nak = key ? (NAK_MAP[key] || "тАФ") : "тАФ";
  document.getElementById("nakshatra").innerText = nak;
}


-->
</body>
</html>
