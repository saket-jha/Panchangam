<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<script src="header.js"></script>
<link rel="stylesheet" href="./css/style.css">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>рд╢реНрд░реАрд╕реВрд░реНрдпрд╕рд┐рджреНрдзрд╛рдиреНрддреАрдп рдкрдЮреНрдЪрд╛рдЩреНрдЧрдореН </title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>

<style>
  body{align-items: center; align-content: center; text-align: center; font-size: larger; font-family:Arial,Helvetica,sans-serif;margin:30px;background:#ffffff;align-content: center;font-weight: bolder;}
  input,select,button{margin:6px 0;padding:8px;border:1px solid #ccc;border-radius:6px;}
  button{background:#007bff;color:#fff;cursor:pointer;}
  button:hover{background:#0056b3;}
  #result{  background:#f9e0a6;border-radius:10px;padding:20px;margin-top:20px;
          box-shadow:0 0 10px rgba(0,0,0,0.1);}
  b{color:#007bff;}
</style>
</head>
<body>
  <div class="layout-container">
    <div class="info-panel">
        <!-- Your left panel content here -->
         <div style="color: #000000;background-color: #ffffff;font-size: 14px;font-family: Arial, Helvetica, unicode MS, 'Courier New', monospace;"><span style="color: #cccccc;"><span style="color: rgb(44, 130, 201);"><strong><span style="font-size: 17px;">
            рее рд╢реНрд░реАрд╕реВрд░реНрдпрд╕рд┐рджреНрдзрд╛рдиреНрддрдГ рд╢реБрджреНрдз рд╢рд╛рд╕реНрддреНрд░реАрдп рее</span></strong></span><span style="color: #000000;"><br></span><span style="color: rgb(226, 80, 65);"><strong><span style="font-size: 15px;">рдПрдХ рд╡реИрджрд┐рдХ-рдкреМрд░рд╛рдгрд┐рдХ-рдЬреНрдпреЛрддрд┐рд╖реАрдп рд╡рд┐рд╡реЗрдЪрди:</span></strong></span><br><span style="color: #000000;">рднрд╛рд░рддреАрдп рдХрд╛рд▓рдЧрдгрдирд╛ рдореЗрдВ&nbsp;<strong>рдЖрдЬ</strong> рджреЛ рдкрджреНрдзрддрд┐рдпрд╛рдБ рдкреНрд░рдЪрд▓рд┐рдд рд╣реИрдВ&mdash;<br><span style="color: #000000;">рез. рд╕реВрд░реНрдпрд╕рд┐рджреНрдзрд╛рдиреНрдд рдкрд░ рдЖрдзрд╛рд░рд┐рдд рдкрд╛рд░рдореНрдкрд░рд┐рдХ рдкрдЮреНрдЪрд╛рдЩреНрдЧ</span></span><br><span style="color: #000000;">реи. рджреГрдХреН-рдкрдХреНрд╖реАрдп рдкрдЮреНрдЪрд╛рдЩреНрдЧ (Drik Panchang)</span><br><span style="color: #000000;">рдЖрдзреБрдирд┐рдХ рдХрд╛рд▓ рдореЗрдВ рдХрдИ рд╡рд┐рджреНрд╡рд╛рди рдЧреНрд░рд╣реЛрдВ рдХреА рддрддреНрдХрд╛рд▓реАрди <strong>рднреМрддрд┐рдХ</strong> рдЦрдЧреЛрд▓реАрдп рдЧрддрд┐ (real-time ephemeris) рдкрд░ рдЖрдзрд╛рд░рд┐рдд рджреГрдХреН-рдкрдХреНрд╖ рдХреЛ рд╡реИрдЬреНрдЮрд╛рдирд┐рдХ рдорд╛рди рд▓реЗрддреЗ рд╣реИрдВ; рдкрд░рдиреНрддреБ рд╢рд╛рд╕реНрддреНрд░реАрдп рдЖрдзрд╛рд░ рдкрд░ рдкрдЮреНрдЪрд╛рдЩреНрдЧ-рдирд┐рд░реНрдгрдп рдХрд╛ рдореВрд▓ рдкреНрд░рдорд╛рдг рд╕реВрд░реНрдпрд╕рд┐рджреНрдзрд╛рдиреНрдд рд╣реА рдорд╛рдирд╛ рдЧрдпрд╛ рд╣реИред рд╢рд╛рд╕реНрддреНрд░ рдХрд╛ рдЙрджреНрджреЗрд╢реНрдп <strong>рджреЗрд╡-рдХрд╛рд▓, рдЛрддреБ-рдЪрдХреНрд░, рдзрд░реНрдо-рдХрд░реНрдо рдФрд░ рдмреНрд░рд╣реНрдорд╛рдгреНрдбреАрдп рд▓рдп</strong> рдХреЛ рдпрдерд╛рд╡рддреН рд░реВрдк рдореЗрдВ рдЧреНрд░рд╣рдг рдХрд░рдирд╛ рд╣реИ&mdash;рди рдХрд┐ рдХреЗрд╡рд▓ рдХреНрд╖рдгрд┐рдХ рднреМрддрд┐рдХ рд╕реНрдерд┐рддрд┐ рдХреЛред</span><br><span style="color: #000000;">рдЗрд╕реАрд▓рд┐рдП рд╢рд╛рд╕реНрддреНрд░реАрдп рдкрд░рдореНрдкрд░рд╛ рд╕рд░реНрд╡рд╕рдореНрдорддрд┐ рд╕реЗ рдХрд╣рддреА рд╣реИ&mdash;<br></span><span style="color: rgb(44, 130, 201);"><strong>&ldquo;рд╕реМрд░реНрдпрдореН рд╕рд┐рджреНрдзрд╛рдиреНрддрдВ рд╣рд┐ рдкрдЮреНрдЪрд╛рдЩреНрдЧрд╕реНрдп рдореВрд▓рдореН&rdquo;</strong></span><span style="color: #000000;"><br>рдЕрд░реНрдерд╛рддреН рд╕реВрд░реНрдпрд╕рд┐рджреНрдзрд╛рдиреНрдд рд╣реА рдкрдЮреНрдЪрд╛рдЩреНрдЧ рдХрд╛ рдкрд░рдо рдЖрдзрд╛рд░ рд╣реИред</span><br><span style="color: rgb(226, 80, 65);"><strong><span style="font-size: 15px;">рез. рджреИрд╡-рдкреНрд░рдгреАрддрддреНрд╡рдореН &mdash; рд╕реВрд░реНрдпреЛрдкрджрд┐рд╖реНрдЯ рдЬреНрдЮрд╛рди</span></strong></span><br><span style="color: #000000;">рд╕реВрд░реНрдпрд╕рд┐рджреНрдзрд╛рдиреНрдд рдХрд╛ рдЙрджреНрдЧрдо рджреИрд╡рд┐рдХ рдмрддрд╛рдпрд╛ рдЧрдпрд╛ рд╣реИ&mdash;</span><br><span style="color: #000000;">рд╕реВрд░реНрдпрджреЗрд╡ рдиреЗ рдпрд╣ рдЬреНрдЮрд╛рди рдордпрджрд╛рдирд╡ рдХреЛ рдЙрдкрджрд┐рд╖реНрдЯ рдХрд┐рдпрд╛ред</span><br><span style="color: #000000;">рдпрд╣ рд╢рд╛рд╕реНрддреНрд░ рдЛрд╖рд┐-рдкрд░рдореНрдкрд░рд╛ рдореЗрдВ рд╕рдВрд░рдХреНрд╖рд┐рдд рд░рд╣рд╛ред</span><br><span style="color: #000000;">рдЗрд╕реЗ <strong>&ldquo;рджреИрд╡-рдирд┐рд░реНрдорд┐рдд рдХрд╛рд▓-рд╕реВрддреНрд░&rdquo;</strong> рдХрд╣рд╛ рдЧрдпрд╛ред</span><br><span style="color: #000000;">рджреВрд╕рд░реА рдУрд░ рджреГрдХреН-рдкрдХреНрд╖ рдЖрдзреБрдирд┐рдХ рд╡реИрдЬреНрдЮрд╛рдирд┐рдХ рдЙрдкрдХрд░рдгреЛрдВ рдкрд░ рдЖрдзрд╛рд░рд┐рдд рд╣реИ, рдЬрд┐рдирдХрд╛ рджреИрд╡-рдкреНрд░рдорд╛рдг рдпрд╛ рдЛрд╖рд┐-рдордд рд╕реЗ рдХреЛрдИ рд╕рдореНрдмрдиреНрдз рдирд╣реАрдВредрдЕрддрдГ рдзрд░реНрдо-рдХрд░реНрдо рдХреЗ рджреГрд╖реНрдЯрд┐ рд╕реЗ рджреГрдХреН рдкрдЮреНрдЪрд╛рдЩреНрдЧ рдЕрд░реНрдерд╣реАрди рд╣реИ ред</span><br><span style="color: #000000;">рд╢рд╛рд╕реНрддреНрд░ рдХрд╣рддрд╛ рд╣реИ&mdash;&nbsp;</span><span style="color: rgb(226, 80, 65);"><strong>&ldquo;рджреИрд╡рдореН рд╣рд┐ рдХрд╛рд▓рдГ&rdquo;</strong></span><span style="color: #000000;">&nbsp;&ndash; рдХрд╛рд▓ рд╕реНрд╡рдпрдВ рджреЗрд╡рд╕реНрд╡рд░реВрдк рд╣реИред рдЬрдм рдХрд╛рд▓ рджреЗрд╡рддрд╛рдордп рд╣реИ, рддреЛ рдЙрд╕рдХреА рдЧрдгрдирд╛ рднреА <strong>рджреИрд╡-рдкреНрд░рдгреАрдд рд╕рд┐рджреНрдзрд╛рдиреНрдд</strong> рд╕реЗ рд╣реА&nbsp;<strong>рд╢реБрджреНрдз</strong> рд╣реЛрдЧреАред<br></span><br><span style="color: rgb(226, 80, 65);"><strong><span style="font-size: 15px;">реи. рд╢рд╛рд╕реНрддреНрд░реАрдп рдирд┐рд░реНрджреЗрд╢</span></strong></span><span style="color: #000000;">&nbsp;<br>рддрд┐рдерд┐-рдирдХреНрд╖рддреНрд░ рдЖрджрд┐ рд╕реВрд░реНрдпрд╕рд┐рджреНрдзрд╛рдиреНрддреАрдп рд╣реЛрдиреЗ рдЪрд╛рд╣рд┐рдП</span><br><span style="color: #000000;">рдзрд░реНрдорд╢рд╛рд╕реНрддреНрд░реЛрдВ рдореЗрдВ рд╕реНрдкрд╖реНрдЯ рдХрд╣рд╛ рд╣реИ&mdash;</span><br><span style="color: #000000;"><strong>&ldquo;рддрд┐рдереАрдирд╛рдВ рдЧрдгрдирд╛ рд╕рд┐рджреНрдзрд╛рдиреНрддреЗ&rdquo; &ldquo;рдирдХреНрд╖рддреНрд░рд╛рджрд┐рдирд╛рдВ рдирд┐рд░реНрдгрдпрдГ рд╕реВрд░реНрдпрд╕рд┐рджреНрдзрд╛рдиреНрддреЗ рд╕реНрдерд╛рдкрд┐рддрдореН&rdquo;</strong></span><br><span style="color: #000000;">рдЕрд░реНрдерд╛рддреН рддрд┐рдерд┐, рдирдХреНрд╖рддреНрд░, рдпреЛрдЧ, рдХрд░рдг рдЖрджрд┐ рдХрд╛ рдирд┐рд░реНрдгрдп рд╕реВрд░реНрдпрд╕рд┐рджреНрдзрд╛рдиреНрддреАрдп рд╕реВрддреНрд░реЛрдВ рджреНрд╡рд╛рд░рд╛ рд╣реА рд╢реБрджреНрдз рдорд╛рдирд╛ рдЬрд╛рддрд╛ рд╣реИред</span><br><span style="color: #000000;">рджреГрдХреН-рдкрдХреНрд╖реАрдп рдкрдЮреНрдЪрд╛рдЩреНрдЧ рдЗрд╕ рд╢рд╛рд╕реНрддреНрд░реАрдп рдирд┐рдпрдо рдХрд╛ рдкрд╛рд▓рди рдирд╣реАрдВ рдХрд░рддрд╛,рдХреНрдпреЛрдВрдХрд┐ рд╡рд╣ рднреМрддрд┐рдХ рдЦрдЧреЛрд▓реАрдп рдЖрдБрдХрдбрд╝реЗ рд▓реЗрддрд╛ рд╣реИ, рди рдХрд┐ рд╢рд╛рд╕реНрддреНрд░рд╕рдореНрдордд рд╕рд╡рд┐рддрд╛ рджреЗрд╡рддрд╛ рдкрд░ рдЖрдзрд╛рд░рд┐рдд рдЧрдгрдирд╛ред</span><br><span style="color: #000000;">рдЗрд╕ рдкреНрд░рдХрд╛рд░ рджреГрдХреН рдкрдЮреНрдЪрд╛рдЩреНрдЧ рд╢рд╛рд╕реНрддреНрд░реАрдп рдкреНрд░рдорд╛рдг рдХрд╛ рдЕрдзрд┐рдХрд╛рд░ рдирд╣реАрдВ рд░рдЦрддрд╛, рдЬрдмрдХрд┐ рд╕реВрд░реНрдпрд╕рд┐рджреНрдзрд╛рдиреНрдд рд╢рд╛рд╕реНрддреНрд░ рдкреНрд░рджрддреНрдд рд╕рд░реНрд╡реЛрдЪреНрдЪ рдкреНрд░рдорд╛рдг рд╣реИред<br></span><br><span style="color: rgb(226, 80, 65);"><strong><span style="font-size: 15px;">рей. </span></strong><span style="font-size: 15px;"><strong>рдзрд░реНрдо-рдХрд░реНрдо рдореЗрдВ &ldquo;рд╕рд┐рджреНрдзрд╛рдиреНрдд рд╢реБрджреНрдзрд┐&rdquo; рдЕрдкреЗрдХреНрд╖рд┐рдд рд╣реИ, рди рдХрд┐ &ldquo;рджреГрдХреН-рдХреНрд╖рдгрд┐рдХрддрд╛&rdquo;</strong></span></span><br><span style="color: #000000;">рд╡реИрджрд┐рдХ рдХрд░реНрдордХрд╛рдгреНрдб рдореЗрдВ рджрд┐рд╡реНрдп рдХрд╛рд▓ рдХреА рдЧрдгрдирд╛ рдЪрд╛рд╣рд┐рдП, рди рдХрд┐ рднреМрддрд┐рдХ, рдкрд░рд┐рдХреНрд╖рдгреАрдп рдХрд╛рд▓ред</span><br><span style="color: #000000;">рдпрдЬреНрдЮ, рдЬрдк, рд╕рдВрд╕реНрдХрд╛рд░ рдЖрджрд┐ рдХреЗ рдлрд▓ рднреМрддрд┐рдХ рдЦрдЧреЛрд▓реАрдп рд╕реНрдерд┐рддрд┐ рдкрд░ рдирд┐рд░реНрднрд░ рдирд╣реАрдВ,</span><br><span style="color: #000000;">рдЕрдкрд┐рддреБ рджреИрд╡-рдирд┐рдпрдд рдХрд╛рд▓рдЪрдХреНрд░ рдкрд░ рдирд┐рд░реНрднрд░ рд╣реИрдВред</span><br><span style="color: #000000;">рд╕реВрд░реНрдпрд╕рд┐рджреНрдзрд╛рдиреНрдд рдХреА рдЧрддрд┐ рджреИрд╡-рдирд┐рдпрдд рдФрд░ рд╕реНрдерд┐рд░ рд╣реИред рдЗрд╕рд╕реЗ рдкреНрд░рд╛рдкреНрдд рдкрдЮреНрдЪрд╛рдЩреНрдЧ рдЛрддреБрдордп, рд╕реГрд╖реНрдЯрд┐рдЪрдХреНрд░рд╛рдиреБрдЧрдд рдФрд░ рд╡реИрджрд┐рдХ рдЕрдиреБрдХреВрд▓ рд╣реЛрддрд╛ рд╣реИред<br></span><br><span style="color: rgb(226, 80, 65);"><strong><span style="font-size: 15px;">рек. рд╕реВрд░реНрдпрд╕рд┐рджреНрдзрд╛рдиреНрдд рдЛрддреБ-рдЪрдХреНрд░ рдФрд░ рджреЗрд╡-рдХрд╛рд▓ рдХреЗ рд╕рдВрдЧрдд; рджреГрдХреН-рдкрдХреНрд╖ рдХреЗрд╡рд▓ рднреМрддрд┐рдХ</span></strong></span><br><span style="color: #000000;">рдзрд░реНрдорд╢рд╛рд╕реНрддреНрд░ рдХрд╣рддрд╛ рд╣реИ&mdash;&ldquo;рдЛрддрд╡рдГ рджреЗрд╡рдХрд░реНрдорд╕реБ рдкреНрд░рдзрд╛рдирд╛рдГред&rdquo;</span><br><span style="color: #000000;">рдЛрддреБ-рдирд┐рд░реНрдгрдп рд╕реВрд░реНрдп рдХреА рджреАрд░реНрдШрд╡реГрддреНрддреАрдп рдЧрддрд┐ рдкрд░ рдЖрдзрд╛рд░рд┐рдд рд╣реИ, рдЬрд┐рд╕реЗ рд╕реВрд░реНрдпрд╕рд┐рджреНрдзрд╛рдиреНрдд рдЕрддреНрдпрдиреНрдд рд╕реВрдХреНрд╖реНрдорддрд╛ рд╕реЗ рдкреНрд░рдХрдЯ рдХрд░рддрд╛ рд╣реИред&nbsp;</span><br><br><br><span style="color: #000000;">рд╢реНрд░рд╛рджреНрдз, рд╕рдВрд╕реНрдХрд╛рд░, рдпрдЬреНрдЮ, рдкреВрдЬрд╛,&nbsp;рд╡реНрд░рдд-рдирд┐рдпрдо, рд╕рдВрдХреНрд░рд╛рдиреНрддрд┐,&nbsp;рдирдХреНрд╖рддреНрд░-рд╡рд┐рдзрд╛рди, рдЛрддреБ рдкрд░рд┐рд╡рд░реНрддрди,&nbsp;рдЙрддреНрд╕рд╡ рд╡ рджреЗрд╡рдХрд╛рд▓&nbsp;рдЗрдирдХрд╛ рдЖрдзрд╛рд░ рджреИрд╡-рдирд┐рдпрдд рдХрд╛рд▓ рд╣реИ, рди рдХрд┐ рд╕реВрд░реНрдп-рдЪрдиреНрджреНрд░ рдХреА рднреМрддрд┐рдХ рд╕реНрдерд┐рддрд┐ред</span><br><span style="color: #000000;">рдЙрджрд╛рд╣рд░рдг:</span><br><span style="color: #000000;">рд╢рдХреБрди-рд╡рд┐рдзрд┐</span><br><span style="color: #000000;">рд╡рд┐рд╡рд╛рд╣рд╛рджрд┐ рд╢реБрдн-рдореБрд╣реВрд░реНрдд</span><br><span style="color: #000000;">рд╢реНрд░рд╛рджреНрдз-рддрд┐рдерд┐</span><br><span style="color: #000000;">рдЧреНрд░рд╣рд╢рд╛рдиреНрддрд┐ рд╡рд┐рдзрд╛рди</span><br><span style="color: #000000;">рдЗрди рд╕рднреА рдореЗрдВ рд╢рд╛рд╕реНрддреНрд░реАрдп рдирд┐рд░реНрджреЗрд╢ рд╕реВрд░реНрдпрд╕рд┐рджреНрдзрд╛рдиреНрдд рдХреЛ рд╣реА рдкреНрд░рдорд╛рдг рдорд╛рдирддреЗ рд╣реИрдВред рджреГрдХреН-рдкрдХреНрд╖ рдЗрди рдзрд╛рд░реНрдорд┐рдХ рд╢рд╛рд╕реНрддреНрд░реЛрдВ рдХреЗ рдЕрдиреБрдХреВрд▓ рдирд╣реАрдВ рд╣реИред<br></span><br><br><span style="color: rgb(226, 80, 65);"><strong><span style="font-size: 15px;">рел. рдкрд░рдореНрдкрд░рд╛&ndash;рд╕рд┐рджреНрдзрддрд╛</span></strong></span><br><span style="color: #000000;">рднрд╛рд░рддреАрдп рдкрдВрдЪрд╛рдВрдЧ рдкрд░рдореНрдкрд░рд╛&nbsp;</span><span style="color: #000000;">рд╕рд╣рд╕реНрд░рд╛рдмреНрджрд┐рдпреЛрдВ рд╕реЗ рд╕реВрд░реНрдпрд╕рд┐рджреНрдзрд╛рдиреНрдд рдкрд░ рдЖрдзрд╛рд░рд┐рдд рд╣реИрдВред</span><br><span style="color: #000000;">рджреГрдХреН-рдкрдХреНрд╖ рдорд╛рддреНрд░ 100&ndash;120 рд╡рд░реНрд╖ рдкреБрд░рд╛рдирд╛ рдЖрдзреБрдирд┐рдХ рдкреНрд░рдпрд╛рд╕ рд╣реИред рдРрд╕реЗ рдЕрд▓реНрдкрдХрд╛рд▓реАрди рдкреНрд░рдпреЛрдЧ рдХреЛ рд╢рд╛рд╕реНрддреНрд░реАрдп рдкрд░рдореНрдкрд░рд╛ рдкрд░ рд╕рд░реНрд╡реЛрдкрд░рд┐ рдирд╣реАрдВ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ред</span></div>


    </div>
    <div class="main-panel">
      <!-- Your left panel content here -->
       <h1 style="text-align: center; font-size: larger;">рд╢реНрд░реАрд╕реВрд░реНрдпрд╕рд┐рджреНрдзрд╛рдиреНрддреАрдп рдкрдЮреНрдЪрд╛рдЩреНрдЧрдореН </h1>


<input type="file" id="excelFile" style="display:none" accept=".xlsx,.xls" />
<select id="fileLink">
  <option value="">рд╕реНрдерд╛рди рдЪреБрдиреЗрдВ</option>
  <option value="https://dl.dropboxusercontent.com/scl/fi/f0wbxmv8o980slrf9tu78/kashi2026.xlsx?rlkey=rcg3wqkgtr5h96eagaq9lrhsr&st=9qdszwtc" data-lat="25.3176" data-lon="82.9739">рдХрд╛рд╢реА</option>
  <option value="https://dl.dropboxusercontent.com/scl/fi/0bqwm2tujar29lx3lojkk/Jammu2026.xlsx?rlkey=zh2ilevfrdcyg0eav0xitcr58&st=861magrj" data-lat="32.7500" data-lon="74.8333">рдЬрдореНрдореВ</option>
  <option value="https://dl.dropboxusercontent.com/scl/fi/pfs2i8vwidu9ae30a74ge/Jaipur2026.xlsx?rlkey=zgnab4o66ualfuv0z10mxf3ef&st=8od76qgz" data-lat="27.0000" data-lon="76.0000">рдЬрдпрдкреБрд░</option>
  <option value="https://dl.dropboxusercontent.com/scl/fi/80ko4l0ahvm5pfyzbcubi/Darbhanga2026.xlsx?rlkey=pjb5cffap0t0ysy2b244361co&st=5cbwkijc" data-lat="26.0000" data-lon="86.0000">рджрд░рднрдЩреНрдЧрд╛</option>
  <option value="https://dl.dropboxusercontent.com/scl/fi/14dto41n2vzhw7x6qio60/NewDelhi2026.xlsx?rlkey=ktm6wgjgpykq2g50mz0oi8m9r&st=xtvigu8y" data-lat="28.6000" data-lon="77.2000">рдирдИ рджрд┐рд▓реНрд▓реА</option>
  <option value="https://dl.dropboxusercontent.com/scl/fi/vujop3gfrrvvb9ym4mrcc/Ludhiana2026.xlsx?rlkey=jwgiee421mbdijv25xpx6p5rd&st=6gss7hi5" data-lat="30.8833" data-lon="75.8500">рд▓реБрдзрд┐рдпрд╛рдирд╛</option>
</select><br><br>

<button onclick="loadFile()">рдкреБрд╖реНрдЯрд┐ рдХрд░реЗрдВ</button><br><br>

<div id="dateSection" style="display:none; text-align: center;">
  <label style="font-size: larger;">рдЖрдЩреНрдЧреНрд▓ рджрд┐рдирд╛рдЩреНрдХ рдЪреБрдиреЗрдВ</label><br>
  <input type="date" style="font-size: larger;" id="datePicker" /><br><br>
  <button onclick="searchData()" style="font-size: larger;">рдкрдЮреНрдЪрд╛рдЩреНрдЧ</button>
  <button onclick="searchData();displayChakra()" style="font-size: larger;">рдЪрдХреНрд░ рджреЗрдЦреЗрдВ</button>
</div>

<h3 style="text-align: center; font-size: larger;">рдЪрдпрдирд┐рдд рджрд┐рдирд╛рдЩреНрдХ рдХрд╛ рдкрдЮреНрдЪрд╛рдЩреНрдЧ</h3>
<div id="result" style="text-align: center; font-size: larger;"></div>
<button id="panchangam_export" class="gc_btn">Export PNG</button>
<div id="panchangam">
  <img class="bg-img" src="./images/suryadev.jpg" />
  <div class="overlay"></div>
  <div class="content">
  <p>реереР рд╢реНрд░реАрдЧрдгреЗрд╢рд╛рдп рдирдо:рее</p>
  <p>реерд╢реНрд░реАрд╕реВрд░реНрдпрд╕рд┐рджреНрдзрд╛рдиреНрддреАрдп ЁЯМЮ рдкрдЮреНрдЪрд╛рдЩреНрдЧрее</p>  
  <p><span id="nDinaank" class="heading">рджрд┐рдирд╛рдВрдХ: </span><span id="dinaank" class="value"></span> рдИреж</p>
  <p><span id="nVSamvat" class="heading">рд╡рд┐рдХреНрд░рдо рд╕рдореНрд╡рдд: </span> <span id="vSamvat" class="value" ></span></p>
  <p><span id="nSSamvat" class="heading">рд╢рдХ рд╕рдореНрд╡рдд: </span> резрепрекрен</p>
  <p><span id="nRitu" class="heading">рдЛрддреБ: </span><span id="ritu" class="value" ></span></p>
  <p><span id="nMaasPaksha" class="heading">рдорд╛рд╕ рд╡ рдкрдХреНрд╖: </span><span id="maas"  class="value"></span>&nbsp;<span id="paksha"  class="value"></span></p>
  <p><span id="nDin" class="heading">рд╡рд╛рд░: </span><span id="din" class="value"></span></p>
  <p><span id="nTithi" class="heading">рддрд┐рдерд┐: </span><span id="tithi" class="value"></span> (<span id="tithyant" class="value"></span> рдмрдЬреЗ рддрдХ)</p>
  <p><span id="nNakshatra" class="heading">рдирдХреНрд╖рддреНрд░: </span><span id="nakshatra" class="value"></span> (<span id="nakshatraant" class="value"></span> рдмрдЬреЗ рддрдХ)</p>

  <!-- Rashi spans remain in HTML but are NOT set by this script -->
  <p><span id="nRashi" class="heading">рд░рд╛рд╢рд┐: </span> <span id="rashi" class="value"></span>&nbsp;<span id="rashyant" class="value"></span> <span id="rashi2" class="value"></span></span>)</p>

  <p><span id="nKaran1" class="heading">рдХрд░рдг рез:</span><span id="karan" class="value"></span> (<span id="karanant1" class="value"></span> рдмрдЬреЗ рддрдХ)</p>
  <p><span id="nKaran2" class="heading">рдХрд░рдг реи:</span> <span id="karan2" class="value"></span> (<span id="karanant2" class="value"></span> рдмрдЬреЗ рддрдХ)</p>
  <p><span id="nKaran3" class="heading">рдХрд░рдг рей:</span> <span id="karan3" class="value"></span> (рд╕реВрд░реНрдпреЛрджрдпрдкрд░реНрдпрдиреНрдд)</p>

  <p><span id="nYog" class="heading">рдпреЛрдЧ: </span><span id="yog" class="value"></span> (<span id="yogant" class="value"></span> рдмрдЬреЗ рддрдХ)</p>
  <p><span id="nSuryodaya" class="heading">рд╕реВрд░реНрдпреЛрджрдп: </span><span id="suryodaya" class="value"></span> рдмрдЬреЗ</p>
  <p><span id="nSuryast" class="heading">рд╕реВрд░реНрдпрд╛рд╕реНрдд: </span><span id="suryast" class="value"></span> рдмрдЬреЗ</p>
  <p><span id="nDikshool" class="heading">рджрд┐рд╢рд╛рд╢реВрд▓: </span><span id="dikshool" class="value"></span></p>
  <p>реерддрдиреНрдореЗрдордирдГ рд╢рд┐рд╡рд╕рдЩреНрдХрд▓реНрдкрдорд╕реНрддреБрее</p>
</div></div>

<!-- Chart container -->
<div id="gc_container" >
  <div id="gc_controls" >
    <select id="gc_style" class="gc_sel" style="display: none;" >
      <option value="south">рдЪрдХреНрд░рдореН</option>
      <option value="north">рд╡рд░реНрдЧ</option>
    </select>
    <button id="gc_export"  class="gc_btn">Export PNG</button>
    <button id="gc_hide" class="gc_btn">Hide Chart</button>
  </div>

  <div id="gc_canvas_wrap" style="position:relative; display:inline-block;">
  <img id="north_bg" src="KundaleeSample.jpg" style="width:100%; max-width:420px; display:block;">
  <canvas id="gc_canvas" style="position:absolute; top:0; left:0;"></canvas>
  <div id="gc_tooltip"></div>
</div>

    <div id="gc_tooltip"></div>
  </div>
</div>

    <div class="info2-panel">
        <!-- Your right panel content here -->
        ┬й рд╢реНрд░реАрд╕реВрд░реНрдпрд╕рд┐рджреНрдзрд╛рдиреНрддреАрдп рдкрдЮреНрдЪрд╛рдЩреНрдЧрдореН |<b></b>
        рдЗрд╕ рдкреГрд╖реНрда рдкрд░ рдЙрдкреНрд▓рдмреНрдз рдЧрдгрдирд╛ рдЖрдЪрд╛рд░реНрдп рд╢реНрд░реА рд╡рд┐рдирдп рдЭрд╛ рдЬреА рджреНрд╡рд╛рд░рд╛ рдирд┐рд░реНрдорд┐рдд Kundalee Software рд╕реЗ рд▓рд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ рд╡ рдкреВрд░реНрдгрддрдГ рд╢реНрд░реАрд╕реВрд░реНрдпрд╕рд┐рджреНрдзрд╛рдиреНрддреАрдп рд╣реИ <br>

    </div>
  </div>



<script>
/* ---------- Keep your original parsing helpers (unchanged) ---------- */
let workbookData = null;
function normalizeDate(v){
  if(!v) return "";
  if(!isNaN(v)){
    const base=new Date(Date.UTC(1899,11,30));
    base.setDate(base.getDate()+Number(v));
    return base.toLocaleDateString("en-GB");
  }
  const d=new Date(v);
  if(!isNaN(d)) return d.toLocaleDateString("en-GB");
  return v.toString().trim();
}
function excelTimeToHMS(value){
  if(isNaN(value)) return value;
  const totalSec=Math.round(value*24*3600);
  const h=Math.floor(totalSec/3600);
  const m=Math.floor((totalSec%3600)/60);
  const s=totalSec%60;
  return `${h.toString().padStart(2,"0")}:${m.toString().padStart(2,"0")}:${s.toString().padStart(2,"0")}`;
}

/* ---------- Load file (unchanged) ---------- */
async function loadFile(){
  const file=document.getElementById("excelFile").files[0];
  const link=document.getElementById("fileLink").value.trim();
  const resDiv=document.getElementById("result");
  resDiv.innerHTML="тП│ рдЧрдгрдирд╛ рд╣реЛ рд░рд╣реА рд╣реИ.....";
  try{
    let buffer;
    if(file){ buffer=await file.arrayBuffer(); }
    else if(link){ const resp=await fetch(link); if(!resp.ok) throw new Error("Cannot load file"); buffer=await resp.arrayBuffer(); }
    else{ resDiv.innerHTML="тЪая╕П рдХреГрдкрдпрд╛ рдкрд╣рд▓реЗ рд╕реНрдерд╛рди рдЪреБрдиреЗрдВ"; return; }
    const wb=XLSX.read(new Uint8Array(buffer),{type:"array"});
    const sh=wb.Sheets[wb.SheetNames[0]];
    workbookData=XLSX.utils.sheet_to_json(sh,{header:1,raw:true,defval:""});
    document.getElementById("dateSection").style.display="block";
    resDiv.innerHTML="тЬЕ рдХреГрдкрдпрд╛ рдЖрдЩреНрдЧреНрд▓ рджрд┐рдирд╛рдЩреНрдХ рдЪреБрдиреЗрдВ";
  }catch(err){
    console.error(err);
    resDiv.innerHTML="тЭМ рдЧрдгрдирд╛ рдХрд░рдиреЗ рдореЗрдВ рддреНрд░реБрдЯрд┐ рд╣реЛ рд░рд╣реА рд╣реИ";
  }
}

/* ---------- searchData: fills window.colN and computes Lagna ---------- */
function searchData(){
  if(!workbookData){document.getElementById("result").innerHTML="тЪая╕П Load a file first.";return;}
  const picker=document.getElementById("datePicker");
  if(!picker.value){document.getElementById("result").innerHTML="тЪая╕П Please select a date.";return;}
  const selectedDate=new Date(picker.value).toLocaleDateString("en-GB");
  const headers=workbookData[0] || [];
  const row=workbookData.find((r,i)=>i>0 && normalizeDate(r[0])===selectedDate);
  const resDiv=document.getElementById("result");
  if(!row){resDiv.innerHTML="тЭМ рджрд┐рдирд╛рдЩреНрдХ "+selectedDate+" рдЙрдкрд▓рдмреНрдз рдирд╣реАрдВ рд╣реИ"; return;}

  // clear previous col vars
  for(let k in window){ if(k.startsWith('col')) delete window[k]; }
  // populate column vars exactly like before
  let out=`<b>Date:</b> ${selectedDate}<br><br>`;
  for(let i=1;i<headers.length;i++){
    let name=headers[i] || ("col"+i);
    let val = row[i];


    /*/ -----------------------------
    // DEVNAGARI CONVERSIONS (RESTORED)
    // -----------------------------
    // DAY NAME
    const dayMap = { Sun:"рд░рд╡рд┐рд╡рд╛рд░", Mon:"рд╕реЛрдорд╡рд╛рд░", Tue:"рдордВрдЧрд▓рд╡рд╛рд░", Wed:"рдмреБрдзрд╡рд╛рд░",
                     Thu:"рдмреГрд╣рд╕реНрдкрддрд┐рд╡рд╛рд░", Fri:"рд╢реБрдХреНрд░рд╡рд╛рд░", Sat:"рд╢рдирд┐рд╡рд╛рд░" };
    if(i===2 && dayMap[val]) val = dayMap[val];

    // NAKSHATRA NAME
    const nakshatraMap = {
      "1-Ashvini":"рдЕрд╢реНрд╡рд┐рдиреА","2-Bharani":"рднрд░рдгреА","3-Krittik├д":"рдХреГрддреНрддрд┐рдХрд╛",
      "4-Rohini":"рд░реЛрд╣рд┐рдгреА","5-Mrigshir├д":"рдореГрдЧрд╢реАрд░реНрд╖","6-├Дrdr├д":"рдЖрд░реНрджреНрд░рд╛",
      "7-Punarvasu":"рдкреВрдирд░реНрд╡рд╕реВ","8-Pu┼бya":"рдкреБрд╖реНрдп","9-├Дshle┼б├д":"рдЖрд╢реНрд▓реЗрд╖рд╛",
      "10-Magh├д":"рдордШрд╛","11-1Ph├дlguni":"рдкреВрд░реНрд╡рд╛рдлрд╛рд▓реНрдЧреБрдиреА","12-2Ph├дlguni":"рдЙрддреНрддрд░рд╛рдлрд╛рд▓реНрдЧреБрдиреА",
      "13-Hasta":"рд╣рд╕реНрдд","14-Chitr├д":"рдЪрд┐рддреНрд░рд╛","15-Sv├дti":"рд╕реНрд╡рд╛рддреА",
      "16-Vish├дkh├д":"рд╡рд┐рд╢рд╛рдЦрд╛","17-Anur├дdh├д":"рдЕрдиреБрд░рд╛рдзрд╛","18-Jye┼бth├д":"рдЬреНрдпреЗрд╖реНрдард╛",
      "19-Moola":"рдореВрд▓","20-1├Д┼б├дdha":"рдкреВрд░реНрд╡рд╛рд╖рд╛рдврд╝рд╛","21-2├Д┼б├дdha":"рдЙрддреНрддрд░рд╛рд╖рд╛рдврд╝рд╛",
      "22-Shravana":"рд╢реНрд░рд╡рдг","23-Dhani┼бth├д":"рдзрдирд┐рд╖реНрдард╛","24-Shatbhi┼б":"рд╢рддрднрд┐рд╖рд╛",
      "25-1Bh├дdrpad":"рдкреВрд░реНрд╡рднрд╛рджреНрд░рдкрдж","26-2Bh├дdrpad":"рдЙрддреНрддрд░рднрд╛рджреНрд░рдкрдж","27-Revati":"рд░реЗрд╡рддреА"
    };
    if(i===16 && nakshatraMap[val]) val = nakshatraMap[val];

    // YOG NAME
    const yogMap = {
      "01:Vi┼бkambh":"рд╡рд┐рд╖реНрдХреБрдореНрдн","02:Preeti":"рдкреНрд░реАрддрд┐","03:Ayu┼бm├дn":"рдЖрдпреБрд╖реНрдорд╛рди",
      "04:Saubh├дgy":"рд╕реМрднрд╛рдЧреНрдп","05:Shobhan":"рд╢реЛрднрди","06:Atigand":"рдЕрддрд┐рдЧрдгреНрдб",
      "07:Sukarman":"рд╕реБрдХрд░реНрдорд╛","08:Dhriti":"рдзреГрддрд┐","09:Shoola":"рд╢реВрд▓",
      "10:Ganda":"рдЧрдгреНрдб","11:Vriddhi":"рд╡реГрджреНрдзрд┐","12:Dhruva":"рдзреНрд░реБрд╡",
      "13:Vy├дgh├дt":"рд╡реНрдпрд╛рдШрд╛рдд","14:Har┼бan":"рд╣рд░реНрд╖рдг","15:Vajra":"рд╡рдЬреНрд░",
      "16:Siddhi":"рд╕рд┐рджреНрдзрд┐","17:Vyatip├дt":"рд╡реНрдпрддреАрдкрд╛рдд","18:Variy├дn":"рд╡рд░реАрдпрд╛рдиреН",
      "19:Parigha":"рдкрд░рд┐рдШ","20:Shiva":"рд╢рд┐рд╡","21:Siddha":"рд╕рд┐рджреНрдз","22:S├дdhy":"рд╕рд╛рдзреНрдп",
      "23:Shubha":"рд╢реБрдн","24:Shukla":"рд╢реБрдХреНрд▓","25:Brahma":"рдмреНрд░рд╣реНрдо","26:Indra":"рдЗрдиреНрджреНрд░",
      "27:V├жdhrti":"рд╡реИрдзреГрддрд┐"
    };
    if(i===5 && yogMap[val]) val = yogMap[val];

    // KARAN NAME
    const karanMap={
      "Bava":"рдмрд╡","B├дlav":"рдмрд╛рд▓рд╡","Kaulav":"рдХреМрд▓рд╡","Taitil":"рддреИрддрд┐рд▓",
      "Gara":"рдЧрд░","Vanij":"рд╡рдгрд┐рдЬ","Vi┼бti":"рд╡рд┐рд╖реНрдЯрд┐ (рднрджреНрд░рд╛)",
      "Shakun":"рд╢рдХреБрдирд┐","Chatu┼б":"рдЪрддреБрд╖реНрдкрд╛рдж","N├дga":"рдирд╛рдЧ","Kimstu":"рдХрд┐рдВрд╕реНрдереБрдШреНрди"
    };
    if(i===7 && karanMap[val]) val = karanMap[val];

    // SPECIAL CASE тАФ рдЕрд╣реЛрд░рд╛рддреНрд░
    if(i===13 && String(val).trim()==="0") val = "рдЕрд╣реЛрд░рд╛рддреНрд░";
*/
    // --------------------------------
    // TIME LOGIC (RESTORED EXACTLY)
    // --------------------------------
    if(typeof val==="string" && /^\d{2,}:\d{2}(:\d{2})?$/.test(val.trim())){
      // already formatted time тАФ do nothing
    }
    else if(!isNaN(val) && val!==""){
      const num = parseFloat(val);
      if(num >= 0 && num < 2 && i !== 3){
        val = excelTimeToHMS(num);
      }
    }





    window['col'+i] = val;
    out += `<b>${name}:</b> <span id="col${i}">${val}</span><br>`;
    //out += "";

  }
  

  // ---- find sunrise column automatically (robust) ----
  let sunriseStr = "";
  const headerLower = headers.map(h => (h||"").toString().toLowerCase());
  let sunriseIndex = -1;
  const sunriseCandidates = ['sunrise','рд╕реВрд░реНрдпреЛрджрдп','sun rise','sun_rise','sunrise_time','sunrise time','sun'];
  for(let j=0;j<headerLower.length;j++){
    for(const cand of sunriseCandidates){
      if(headerLower[j].includes(cand)) { sunriseIndex = j; break; }
    }
    if(sunriseIndex !== -1) break;
  }
  if(sunriseIndex === -1){
    // fallback: try common columns 7..12
    for(let j=7;j<=12 && j < row.length;j++){
      if(typeof row[j] === 'string' && row[j].includes(':')) { sunriseIndex=j; break; }
    }
  }
  if(sunriseIndex !== -1){
    sunriseStr = row[sunriseIndex];
    // if numeric Excel time, convert
    if(!isNaN(sunriseStr) && sunriseStr !== "") sunriseStr = excelTimeToHMS(parseFloat(sunriseStr));
  }

  // ---- read selected city lat/lon from option data- attributes ----
  const sel=document.getElementById('fileLink');
  const opt=sel.options[sel.selectedIndex];
  const lat = opt && opt.dataset && opt.dataset.lat ? parseFloat(opt.dataset.lat) : NaN;
  const lon = opt && opt.dataset && opt.dataset.lon ? parseFloat(opt.dataset.lon) : NaN;

  // ---- sun degree is in col17 (user confirmed) ----
  const sunRaw = window['col17'];
  const sunDeg = (typeof window.parseAngleGeneric === 'function') ? window.parseAngleGeneric(sunRaw, true) : (parseFloat(sunRaw) || NaN);

  // ---- compute Lagna (if possible) and store as window.colLAGNA ----
  let lagnaDeg = NaN;
  try{
    if(!isNaN(lat) && !isNaN(lon) && sunriseStr && !isNaN(sunDeg)){
      lagnaDeg = computeLagna(new Date(picker.value), String(sunriseStr), sunDeg, lat, lon);
      if(!isNaN(lagnaDeg)) window.colLAGNA = lagnaDeg;
    }
  }catch(e){ console.warn("lagna compute failed", e); }

  // show summary
  if(!isNaN(lagnaDeg)){
    out += `<b>рд▓рдЧреНрди (рд╕реВрд░реНрдпреЛрджрдпрдХрд╛рд▓реАрди):</b> ${Math.round(lagnaDeg*100)/100}<br>`;
  } else {
    out += `<b>рд▓рдЧреНрди:</b> (not computed) тАФ need sunrise and lat/lon.<br>`;
  }



  resDiv.innerHTML = out;

  // ensure chart is visible and render according to selected style
  document.getElementById('panchangam').style.display = 'block';
  document.getElementById('result').style.display = 'none';
 // renderCurrentStyle();
  document.getElementById("dinaank").innerText = selectedDate;
  document.getElementById("maas").innerText = window.col1 || "";
  document.getElementById("din").innerText = window.col2 || "";
  document.getElementById("tithi").innerText = window.col3 || "";
  document.getElementById("tithyant").innerText = window.col4 || "";
  document.getElementById("yog").innerText = window.col5 || "";
  document.getElementById("yogant").innerText = window.col6 || "";
  document.getElementById("karan").innerText = window.col7 || "";
  document.getElementById("karanant1").innerText = window.col8 || "";
  //document.getElementById("rashi").innerText = rashi || "";
  document.getElementById("karanant2").innerText = window.col9 || "";
 // document.getElementById("spashtSurya").innerText = window.col12 || "";
  document.getElementById("suryodaya").innerText = window.col10 || "";
  document.getElementById("suryast").innerText = window.col11 || "";
 // document.getElementById("rashyant").innerText = window.col13 || "";
  document.getElementById("nakshatraant").innerText = window.col15 || "";

  // day name mapping (if col2 has Sun/Mon etc.)
  const dayMap = { Sun:"рд░рд╡рд┐рд╡рд╛рд░", Mon:"рд╕реЛрдорд╡рд╛рд░", Tue:"рдордЩреНрдЧрд▓рд╡рд╛рд░", Wed:"рдмреБрдзрд╡рд╛рд░", Thu:"рдмреГрд╣рд╕реНрдкрддрд┐рд╡рд╛рд░", Fri:"рд╢реБрдХреНрд░рд╡рд╛рд░", Sat:"рд╢рдирд┐рд╡рд╛рд░" };
  if(window.col2 && dayMap[window.col2]) 
  document.getElementById("din").innerText = dayMap[window.col2];

// dishashool name mapping (if col2 has Sun/Mon etc.)
  const dikshoolMap = { Sun:"рдкрд╢реНрдЪрд┐рдо", Mon:"рдкреВрд░рдм", Tue:"рдЙрддреНрддрд░", Wed:"рдЙрддреНрддрд░", Thu:"рджрдХреНрд╖рд┐рдг", Fri:"рдкрд╢реНрдЪрд┐рдо", Sat:"рдкреВрд░рдм" };
  if(window.col2 && dikshoolMap[window.col2]) 
  document.getElementById("dikshool").innerText = dikshoolMap[window.col2];


  // nakshatra name mapping (if col2 has Sun/Mon etc.)
  const nakshatraMap = { "1-Ashvini": "рдЕрд╢реНрд╡рд┐рдиреА", "2-Bharani": "рднрд░рдгреА", "3-Krittik├д": "рдХреГрддреНрддрд┐рдХрд╛", "5-Mrigshir├д": "рд░реЛрд╣рд┐рдгреА", "6-├Дrdr├д": "рдореГрдЧрд╢рд┐рд░рд╛", "7-Punarvasu": "рдЖрд░реНрджреНрд░рд╛", "8-Pu┼бya": "рдкреБрдирд░реНрд╡рд╕реБ", "9-├Дshle┼б├д": "рдкреБрд╖реНрдп", "10-Magh├д": "рдЕрд╢реНрд▓реЗрд╖рд╛", "11-1Ph├дlguni": "рдордШрд╛", "12-2Ph├дlguni": "рдкреВрд░реНрд╡рд╛рдлрд╛рд▓реНрдЧреБрдиреА", "13-Hasta": "рдЙрддреНрддрд░рд╛рдлрд╛рд▓реНрдЧреБрдиреА", "14-Chitr├д": "рд╣рд╕реНрдд", "15-Sv├дti": "рдЪрд┐рддреНрд░рд╛", "15-Sv├дti": "рд╕реНрд╡рд╛рддреА", "16-Vish├дkh├д": "рд╡рд┐рд╢рд╛рдЦрд╛", "17-Anur├дdh├д": "рдЕрдиреБрд░рд╛рдзрд╛", "18-Jye┼бth├д": "рдЬреНрдпреЗрд╖реНрдард╛", "19-Moola": "рдореБрд▓", "20-1├Д┼б├дdha": "рдкреБрд░реНрд╡рд╛рд╖рд╛рдврд╛", "21-2├Д┼б├дdha": "рдЙрддреНрддрд░рд╖рд╛рдврд╛", "22-Shravana": "рд╢реНрд░рд╡рдг", "23-Dhani┼бth├д": "рдзрдирд┐рд╖реНрдард╛", "24-Shatbhi┼б": "рд╢рддрднрд┐рд╖рд╛", "25-1Bh├дdrpad": "рдкреВрд░реНрд╡рднрд╛рджреНрд░рдкрдж", "26-2Bh├дdrpad": "рдЙрддреНрддрд░рднрд╛рджреНрд░рдкрдж", "27-Revati": "рд░реЗрд╡рддреА" };
  if(window.col16 && nakshatraMap[window.col16]) 
  document.getElementById("nakshatra").innerText = nakshatraMap[window.col16];

  // yog name mapping (if col5 has 01:Vi┼бkambh etc.)
  const yogMap = { "01:Vi┼бkambh": "рд╡рд┐рд╖реНрдХреБрдореНрдн", "02:Preeti": "рдкреНрд░реАрддрд┐", "03:Ayu┼бm├дn": "рдЖрдпреБрд╖реНрдорд╛рди", "04:Saubh├дgy": "рд╕реМрднрд╛рдЧреНрдп", "05:Shobhan": "рд╢реЛрднрди", "06:Atigand": "рдЕрддрд┐рдЧрдгреНрдб", "07:Sukarman": "рд╕реБрдХрд░реНрдорд╛", "08:Dhriti": "рдзреГрддрд┐", "09:Shoola": "рд╢реВрд▓", "10:Ganda": "рдЧрдгреНрдб", "11:Vriddhi": "рд╡реГрджреНрдзрд┐", "12:Dhruva": "рдзреНрд░реБрд╡", "13:Vy├дgh├дt": "рд╡реНрдпрд╛рдШрд╛рдд", "14:Har┼бan": "рд╣рд░реНрд╖рдг", "15:Vajra": "рд╡рдЬреНрд░", "16:Siddhi": "рд╕рд┐рджреНрдзрд┐", "17:Vyatip├дt": "рд╡реНрдпрддреАрдкрд╛рдд", "18:Variy├дn": "рд╡рд░реАрдпрд╛рдиреН", "19:Parigha": "рдкрд░рд┐рдШ", "20:Shiva": "рд╢рд┐рд╡", "21:Siddha": "рд╕рд┐рджреНрдз", "22:S├дdhy": "рд╕рд╛рдзреНрдп", "23:Shubha": "рд╢реБрдн", "24:Shukla": "рд╢реБрдХреНрд▓", "25:Brahma": "рдмреНрд░рд╣реНрдо", "26:Indra": "рдЗрдиреНрджреНрд░", "27:V├жdhrti": "рд╡реИрдзреГрддрд┐"};
  if(window.col5 && yogMap[window.col5]) 
  document.getElementById("yog").innerText = yogMap[window.col5];

 // day name mapping (if col2 has Sun/Mon etc.)
  const karanMap = { "Bava": "рдмрд╡", "B├дlav": "рдмрд╛рд▓рд╡", "Kaulav": "рдХреМрд▓рд╡", "Taitil": "рддреИрддрд┐рд▓", "Gara": "рдЧрд░", "Vanij": "рд╡рдгрд┐рдЬ", "Vi┼бti": "рд╡рд┐рд╖реНрдЯрд┐ (рднрджреНрд░рд╛)" };
  // , "Shakun": "рд╢рдХреБрдирд┐", "Chatu┼б": "рдЪрддреБрд╖реНрдкрд╛рдж", "N├дga": "рдирд╛рдЧ", "Kimstu": "рдХрд┐рд╕реНрддреБрдШреНрди"
  if(window.col7 && karanMap[window.col7]) 
  document.getElementById("karan").innerText = karanMap[window.col7];
 // find next karan
 
      const keys = Object.keys(karanMap);
      const currentIndex = keys.indexOf(window.col7);
      const nextIndex = (currentIndex + 1) % keys.length; // wraps to start if last
      const nextKey = keys[nextIndex];
      const nextIndex1 = (currentIndex + 2) % keys.length; // wraps to start if last
      const nextKey1 = keys[nextIndex1];

      document.getElementById("karan2").innerText = karanMap[nextKey];
      document.getElementById("karan3").innerText = karanMap[nextKey1];
    


  // numeric tithi -> name mapping (if applicable)
  if(!isNaN(window.col3) && window.col3 !== "") {
    const t = Number(window.col3);
    const tithiNames = {
      1:"рдкреНрд░рддрд┐рдкрджрд╛",2:"рджреНрд╡рд┐рддреАрдпрд╛",3:"рддреГрддреАрдпрд╛",4:"рдЪрддреБрд░реНрдереА",5:"рдкрдЮреНрдЪрдореА",6:"рд╖рд╖реНрдареА",7:"рд╕рдкреНрддрдореА",
      8:"рдЕрд╖реНрдЯрдореА",9:"рдирд╡рдореА",10:"рджрд╢рдореА",11:"рдПрдХрд╛рджрд╢реА",12:"рджреНрд╡рд╛рджрд╢реА",13:"рддреНрд░рдпреЛрджрд╢реА",14:"рдЪрддреБрд░реНрджрд╢реА",15:"рдкреВрд░реНрдгрд┐рдорд╛",
      16:"рдкреНрд░рддрд┐рдкрджрд╛",17:"рджреНрд╡рд┐рддреАрдпрд╛",18:"рддреГрддреАрдпрд╛",19:"рдЪрддреБрд░реНрдереА",20:"рдкрдЮреНрдЪрдореА",21:"рд╖рд╖реНрдареА",22:"рд╕рдкреНрддрдореА",
      23:"рдЕрд╖реНрдЯрдореА",24:"рдирд╡рдореА",25:"рджрд╢рдореА",26:"рдПрдХрд╛рджрд╢реА",27:"рджреНрд╡рд╛рджрд╢реА",28:"рддреНрд░рдпреЛрджрд╢реА",29:"рдЪрддреБрд░реНрджрд╢реА",30:"рдкреВрд░реНрдгрд┐рдорд╛"
    };
    document.getElementById("tithi").innerText = tithiNames[t] || window.col3;
    document.getElementById("paksha").innerText = (t <= 15 ? "рд╢реБрдХреНрд▓рдкрдХреНрд╖" : "рдХреГрд╖реНрдгрдкрдХреНрд╖");
  }


    let rashi = Number(col14.split(":")[0])+1*1;
    let rashi2 = Number(col14.split(":")[0])+2*1;

     if (rashi2 == 13){
      rashi2 = 1*1;
     }


     // rashi name mapping ( etc.)
    const rashiMap = { 1:"рдореЗрд╖", 2:"рд╡реГрд╖рдн", 3:"рдорд┐рдереБрди", 4:"рдХрд░реНрдХ", 5:"рд╕рд┐рдВрд╣", 6:"рдХрдиреНрдпрд╛", 7:"рддреБрд▓рд╛", 8:"рд╡реГрд╢реНрдЪрд┐рдХ", 9:"рдзрдиреБ", 10:"рдордХрд░", 11:"рдХреБрдВрдн", 12:"рдореАрди"};
    if(rashi && rashiMap[rashi]) 
    document.getElementById("rashi").innerText = rashiMap[rashi];
    if(rashi2 && rashiMap[rashi]) 
    document.getElementById("rashi2").innerText = rashiMap[rashi2];




     if (window.col13 === "00:00:00" ){
      document.getElementById("rashi").innerText = "(рдЪрдиреНрджреНрд░рдорд╛ *" + rashiMap[rashi] + " рд░рд╛рд╢рд┐* рдореЗрдВ рдЕрд╣реЛрд░рд╛рддреНрд░";
      document.getElementById("rashyant").innerText = " ";
      document.getElementById("rashi2").innerText = " ";
     } else {
     document.getElementById("rashi").innerText = "(рдЪрдиреНрджреНрд░рдорд╛ *" + rashiMap[rashi] + " рд░рд╛рд╢рд┐* рдореЗрдВ ";
     document.getElementById("rashyant").innerText = window.col13 + " рдмрдЬреЗ рддрдХ рддрджреБрдкрд░рд╛рдиреНрдд ";
     document.getElementById("rashi2").innerText = "*" + rashiMap[rashi2] + " рд░рд╛рд╢рд┐* рдореЗрдВ ";

     }
    /*

     let base = Number(col14.split(":")[0]);
let rashi = base + 1;
let rashi2 = base + 2;
if (rashi2 === 13) rashi2 = 1;

if (window.col13 === "00:00:00") {
  document.getElementById("rashi").innerText = "рдЪрдиреНрджреНрд░рдорд╛ " + rashi + " рд░рд╛рд╢рд┐ рдореЗрдВ рд╕реБрд░реНрдпреЛрджрдпрдкрд░реНрдпрдиреНрдд";
  document.getElementById("rashyant").innerText = "";
  document.getElementById("rashi2").innerText = "";
} else {
  document.getElementById("rashi").innerText = "рдЪрдиреНрджреНрд░рдорд╛ " + String(rashi) + " рд░рд╛рд╢рд┐ рдореЗрдВ ";
  document.getElementById("rashyant").innerText = window.col13 + " рдмрдЬреЗ рддрдХ рддрджреБрдкрд░рд╛рдиреНрдд ";
  document.getElementById("rashi2").innerText = "рдЪрдиреНрджреНрд░рдорд╛ " + String(rashi2) + " рд░рд╛рд╢рд┐ рдореЗрдВ рд╕реБрд░реНрдпреЛрджрдпрдкрд░реНрдпрдиреНрдд";
}

*/

//Ritu mapping

let suryaRashi = Number(col12.split(":")[0])+1*1;

     if (suryaRashi == 13){
      suryaRashi = 1*1;
     }
     const rituMap = { 11:"рд╡рд╕рдВрдд",12:"рд╡рд╕рдВрдд", 1:"рдЧреНрд░реАрд╖реНрдо", 2:"рдЧреНрд░реАрд╖реНрдо", 3:"рд╡рд░реНрд╖рд╛", 4:"рд╡рд░реНрд╖рд╛", 5:"рд╢рд░рдж", 6:"рд╢рд░рдж", 7:"рд╣реЗрдордВрдд",8:"рд╣реЗрдордВрдд", 9:"рд╢рд┐рд╢рд┐рд░", 10:"рд╢рд┐рд╢рд┐рд░" };
  if(suryaRashi && rituMap[suryaRashi])
    document.getElementById("ritu").innerText = rituMap[suryaRashi];








  // *** ONLY nakshatra mapping (no rashi mapping) ***
 // setNakshatraOnly(window.col16);
  if (window.col3 === "24:00:00" ){
    document.getElementById("tithi").innerText = "рдкреНрд░рддрд┐рдкрджрд╛";
    document.getElementById("paksha").innerText ="рд╢реБрдХреНрд▓рдкрдХреНрд╖";
  }

//Vikram Samvat computation
// Convert DD/MM/YYYY to Date object
// Convert DD/MM/YYYY to Date object
let parts = selectedDate.split("/");
let day = parseInt(parts[0], 10);
let month = parseInt(parts[1], 10) - 1; // JS month index
let year = parseInt(parts[2], 10);

// Create JS date
let d = new Date(year, month, day);

// Create the boundary date: 20 March of the SAME YEAR
let oldYearBoundary = new Date(2026, 2, 20);  // 11 = December
let newYearBoundary = new Date(year, 2, 20);  // 2 = March

// More precise Vikram Samvat calculation
let vsYear;

// If date is before 20 March тЖТ +56 (old VS year)
// If date is on/after 20 March тЖТ +57 (new VS year)
if (d < oldYearBoundary) {
  vsName = "рд╕рд┐рджреНрдзрд╛рд░реНрде рдирд╛рдордХ рд╕рдВрд╡рддреНрд╕рд░";
} else {
  vsName = "рджреБрд░реНрдорддрд┐ рдирд╛рдордХ рд╕рдВрд╡рддреНрд╕рд░";
}
if (d < newYearBoundary) {
    vsYear = year + 56;
   // vsName = "рд╕рд┐рджреНрдзрд╛рд░реНрде рдирд╛рдордХ рд╕рдВрд╡рддреНрд╕рд░";
} else {
    vsYear = year + 57;
   // vsName = "рджреБрд░реНрдорддрд┐ рдирд╛рдордХ рд╕рдВрд╡рддреНрд╕рд░";
}

document.getElementById("vSamvat").innerText = vsYear + ' "' + vsName + '" ';
//document.getElementById("SSamvat").innerText = (year - 789);
document.getElementById("gc_container").style.display = "none";






  // convert ASCII digits inside govindji to Devanagari (after DOM updated)
  const devanagariDigits = ['реж','рез','реи','рей','рек','рел','рем','рен','рео','реп'];
  function convertToDevanagari(str){ return String(str).replace(/\d/g, d => devanagariDigits[d]); }
  function replaceDigits(node){
    node.childNodes.forEach(n => {
      if(n.nodeType === Node.TEXT_NODE){
        n.textContent = convertToDevanagari(n.textContent);
      } else {
        replaceDigits(n);
      }
    });
  }
  replaceDigits(document.getElementById("panchangam"));
  document.getElementById("panchangam").style.display ="block";
  const textToCopy = document.getElementById("panchangam").innerText;
   navigator.clipboard.writeText(textToCopy);


}

function copyDivText() {
       // Get the div element by its ID
       const divToCopy = document.getElementById('panchangam');

       // Get the inner text content of the div
       const textToCopy = divToCopy.innerText;

       // Use the Clipboard API to write the text to the clipboard
       navigator.clipboard.writeText(textToCopy)
           .then(() => {
               alert('Text copied to clipboard!');
           })
           .catch(err => {
               console.error('Failed to copy text: ', err);
               alert('Failed to copy text.');
           });
   }


/* show chakra button */
function displayChakra(){ 
  document.getElementById("panchangam").style.display = "none";
  document.getElementById("result").style.display = "none";
  document.getElementById("gc_container").style.display = "block"; 
  renderCurrentStyle(); }

/* ------------------- Graha engine (unchanged logic mostly) ------------------- */

/* helpers already used by drawing code */
window.parseSectorAngle = window.parseSectorAngle || function(str){
  if(!str) return NaN; str = String(str).trim();
  if(str.includes(':') && str.includes('┬░')){
    try{
      let [sec, rest] = str.split(':');
      let [dg, rm] = rest.split('┬░');
      let mn = (rm.split("'")[0])||'0';
      let sc = (rm.split("'")[1]||'0').replace(/[^0-9.]/g,'')||'0';
      const S = parseFloat(sec)||0;
      const D = parseFloat(dg)||0;
      const M = parseFloat(mn)||0;
      const S2 = parseFloat(sc)||0;
      return S*30 + D + M/60 + S2/3600;
    }catch(e){ return NaN; }
  }
  return NaN;
};

window.parseAngleGeneric = window.parseAngleGeneric || function(str, isSector){
  if(!str) return NaN; str = String(str).trim();
  if(isSector){
    const v = window.parseSectorAngle(str);
    if(!isNaN(v)) return v;
  }
  if(str.includes('┬░')){
    let [d,rest]=str.split('┬░'), m=0,s=0;
    if(rest){ m = parseFloat((rest.split("'")[0])||0)||0; s = parseFloat((rest.split("'")[1]||'').replace(/[^0-9.]/g,''))||0; }
    return (parseFloat(d)||0) + m/60 + s/3600;
  }
  const n = parseFloat(String(str).replace(/[^0-9.-]/g,''));
  return isNaN(n)? NaN : n;
};

window.RASHI_NAMES = window.RASHI_NAMES || ['рдореЗрд╖','рд╡реГрд╖рдн','рдорд┐рдереБрди','рдХрд░реНрдХ','рд╕рд┐рдВрд╣','рдХрдиреНрдпрд╛','рддреБрд▓рд╛','рд╡реГрд╢реНрдЪрд┐рдХ','рдзрдиреБ','рдордХрд░','рдХреБрдореНрдн','рдореАрди'];
window.NAK_NAMES = window.NAK_NAMES || ["рдЕрд╢реНрд╡рд┐рдиреА","рднрд░рдгреА","рдХреГрддрд┐рдХрд╛","рд░реЛрд╣рд┐рдгреА","рдореГрдЧрд╢реАрд░рд╛","рдЖрд░реНрджреНрд░рд╛","рдкреБрдирд░реНрд╡рд╕реВ","рдкреБрд╖реНрдп","рдЖрд╢реНрд▓реЗрд╖рд╛","рдордШрд╛","рдкреВрд░реНрд╡рдлрд╛рд▓реНрдЧреБрдиреА","рдЙрддреНрддрд░рдлрд╛рд▓реНрдЧреБрдиреА","рд╣рд╕реНрдд","рдЪрд┐рддреНрд░рд╛","рд╕реНрд╡рд╛рддреА","рд╡рд┐рд╢рд╛рдЦрд╛","рдЕрдиреБрд░рд╛рдзрд╛","рдЬреНрдпреЗрд╖реНрдард╛","рдореВрд▓","рдкреВрд░реНрд╡рд╛рд╖рд╛рдврд╝","рдЙрддреНрддрд░рд╛рд╖рд╛рдврд╝","рд╢реНрд░рд╡рдг","рдзрдирд┐рд╖реНрдард╛","рд╢рддрднрд┐рд╖рд╛","рдкреВрд░реНрд╡рднрд╛рджреНрд░рдкрдж","рдЙрддреНрддрд░рднрд╛рджреНрд░рдкрдж","рд░реЗрд╡рддреА"];

/* GC_PLANETS: include RAHU (col24), KETU special, and LAGNA special */
window.GC_PLANETS = window.GC_PLANETS || [
  {label:'рд╕реВрд░реНрдп', col:17, color:'#8f0808', glyph:'тШЙ'},
  {label:'рдЪрдиреНрджреНрд░', col:18, color:'#90caf9', glyph:'тШ╜'},
  {label:'рдордВрдЧрд▓', col:19, color:'#e93e31', glyph:'тЩВ'},
  {label:'рдмреБрдз',   col:20, color:'#8bc34a', glyph:'тШ┐'},
  {label:'рдЧреБрд░реБ',  col:21, color:'#ffeb3b', glyph:'тЩГ'},
  {label:'рд╢реБрдХреНрд░', col:22, color:'#ffff', glyph:'тЩА'},
  {label:'рд╢рдирд┐',  col:23, color:'#2724ef', glyph:'тЩД'},
  {label:'рд░рд╛рд╣реБ', col:24, color:'#0c0c0c', glyph:'тШК'}, // RAHU is col24
  {label:'рдХреЗрддреБ', col:'KETU', color:'#0c0c0c', glyph:'тШЛ'}, // KETU special (Rahu + 180)
  {label:'рд▓рдЧреНрди', col:'LAGNA', color:'#000', glyph:'тЦ▓'}   // LAGNA special
];

/* -------------------- Tooltip (robust, DPR aware) -------------------- */
function attachTooltip(canvas, planets){
  // remove old listeners if any to avoid duplicates
  if(canvas.__gc_tooltip_handler){
    canvas.removeEventListener('mousemove', canvas.__gc_tooltip_handler);
    canvas.removeEventListener('mouseleave', canvas.__gc_tooltip_leave);
    canvas.__gc_tooltip_handler = null;
    canvas.__gc_tooltip_leave = null;
  }

  const dpr = window.devicePixelRatio || 1;
  let tt = document.getElementById('gc_tooltip');
  if(!tt){
    tt = document.createElement('div');
    tt.id='gc_tooltip';
    document.body.appendChild(tt);
    Object.assign(tt.style,{position:'absolute',pointerEvents:'none',display:'none',background:'rgba(0,0,0,0.82)',color:'#fff',padding:'6px 8px',borderRadius:'6px',fontSize:'13px',zIndex:99999});
  }

  const handler = function(ev){
    const rect = canvas.getBoundingClientRect();
    const mx_css = ev.clientX - rect.left;
    const my_css = ev.clientY - rect.top;
    const scaleX = canvas.width / rect.width;
    const scaleY = canvas.height / rect.height;
    const scale = (scaleX + scaleY)/2;

    let best=null, dmin=Infinity;
    for(const p of planets){
      if(!p._pos) continue;
      // p._pos might be in canvas pixels; convert to CSS coords for comparison
      let px = p._pos.x / scale;
      let py = p._pos.y / scale;
      const dx = px - mx_css, dy = py - my_css;
      const d = Math.hypot(dx,dy);
      if(d < dmin){ dmin = d; best = p; }
    }

    const hitRadiusCss = Math.max(10, Math.min(rect.width, rect.height) * 0.035);
    if(best && dmin <= hitRadiusCss){
      tt.style.display = 'block';
      tt.style.left = (ev.pageX + 12) + 'px';
      tt.style.top  = (ev.pageY + 12) + 'px';
      const deg = best._pos && best._pos.deg ? best._pos.deg : NaN;
      const rashiIdx = Number.isFinite(deg) ? Math.floor(((deg%360)+360)%360 / 30) : '';
      const degInt = Number.isFinite(deg) ? Math.floor(deg) : '';
      const minPart = Number.isFinite(deg) ? Math.round(((deg % 1)||0) * 60) : '';
      tt.innerHTML = `<strong>${best.label}</strong><br>${degInt}┬░ ${minPart}'<br>рд░рд╛рд╢рд┐: ${window.RASHI_NAMES[rashiIdx]||''}`;
    } else {
      tt.style.display = 'none';
    }
  };

  const leave = function(){ const t=document.getElementById('gc_tooltip'); if(t) t.style.display='none'; };

  canvas.addEventListener('mousemove', handler);
  canvas.addEventListener('mouseleave', leave);
  canvas.__gc_tooltip_handler = handler;
  canvas.__gc_tooltip_leave = leave;
}

/* -------------------- Lagna calculator (unchanged) -------------------- */
function computeLagna(dateObj, sunriseStr, sunDeg, latDeg, lonDeg) {
  if (!dateObj || !sunriseStr || isNaN(sunDeg)) return NaN;
  let [h,m,s] = sunriseStr.split(":").map(Number);
  if (isNaN(h)) return NaN;
  const sunriseHours = h + m/60 + (s||0)/3600;
  let Y = dateObj.getUTCFullYear();
  let M = dateObj.getUTCMonth() + 1;
  let D = dateObj.getUTCDate() + (sunriseHours / 24);
  if (M <= 2) { Y -= 1; M += 12; }
  const A = Math.floor(Y/100);
  const B = 2 - A + Math.floor(A/4);
  const JD = Math.floor(365.25*(Y+4716)) + Math.floor(30.6001*(M+1)) + D + B - 1524.5;
  const d = JD - 2451545.0;
  let GMST = 280.46061837 + 360.98564736629 * d;
  GMST = ((GMST % 360) + 360) % 360;
  let LST = GMST + lonDeg;
  LST = ((LST % 360) + 360) % 360;
  const sunLong = sunDeg * Math.PI/180;
  const eps = 23.439291 * Math.PI/180;
  const RA = Math.atan2(Math.sin(sunLong)*Math.cos(eps), Math.cos(sunLong));
  let RAdeg = RA*180/Math.PI;
  RAdeg = ((RAdeg % 360)+360)%360;
  let H = LST - RAdeg;
  H = ((H % 360)+360)%360;
  const Hrad = H * Math.PI/180;
  const latRad = latDeg * Math.PI/180;
  const ascRad = Math.atan2(-Math.cos(Hrad), Math.sin(latRad)*Math.sin(Hrad) - Math.cos(latRad)*Math.cos(Hrad));
  let lagnaDeg = ascRad*180/Math.PI;
  lagnaDeg = ((lagnaDeg % 360)+360)%360;
  return lagnaDeg;
}

/* -------------------- DRAW CIRCULAR (south) -------------------- */
function drawCircularChakra(canvas){
  const dpr = window.devicePixelRatio || 1;
  const rect = canvas.getBoundingClientRect();
  const size = Math.min(rect.width || 480, 720); // max 720px

  canvas.width = Math.round(size * dpr);
  canvas.height = Math.round(size * dpr);
  canvas.style.width = size + "px";
  canvas.style.height = size + "px";

  const ctx = canvas.getContext('2d');
  ctx.setTransform(dpr,0,0,dpr,0,0);
  const cx = size/2, cy = size/2;
  const R_outer = size * 0.45;
  const R_inner = size * 0.39;
  const N_outer = R_inner;
  const N_inner = size * 0.33;
  const rashiColors = ['#ff8a9a','#f3b07a','#ffd66f','#c7e29a','#9fe0a7','#81c4d9','#c9a3e8','#f7a1d1','#ffd9a6','#ffc1c1','#d6f1c6','#e7c7ff'];
  const nakColors = ["#f4cccc","#fce5cd","#fff2cc","#d9ead3","#d0e0e3","#cfe2f3","#d9d2e9","#ead1dc","#ffe599","#b6d7a8","#a2c4c9","#9fc5e8","#b4a7d6","#d5a6bd","#f9cb9c","#cfe2f3","#ead1dc","#fff2cc","#d9ead3","#c9daf8","#d0e0e3","#d9d2e9","#f4cccc","#fce5cd","#fff2cc","#d9ead3","#d0e0e3"];
  ctx.clearRect(0,0,size,size);
  ctx.fillStyle = '#f5e2b0'; ctx.fillRect(0,0,size,size);

  // 12 rashi annulus
  for(let i=0;i<12;i++){
    const startDeg = i * 30;
    const endDeg   = (i+1) * 30;
    const a1 = ( - startDeg ) * Math.PI/180;
    const a2 = ( - endDeg   ) * Math.PI/180;
    ctx.beginPath();
    ctx.arc(cx, cy, R_outer, a1, a2, true);
    ctx.arc(cx, cy, R_inner, a2, a1, false);
    ctx.closePath();
    ctx.fillStyle = rashiColors[i % rashiColors.length];
    ctx.fill();
    ctx.beginPath();
    ctx.moveTo(cx + R_outer*Math.cos(a2), cy + R_outer*Math.sin(a2));
    ctx.lineTo(cx + R_inner*Math.cos(a2), cy + R_inner*Math.sin(a2));
    ctx.strokeStyle = '#000'; ctx.lineWidth = Math.max(2.6, size*0.006); ctx.stroke();
  }

  // rashi labels
  ctx.font = Math.max(12, size*0.03) + 'px Arial'; ctx.fillStyle = '#3a1a00'; ctx.textAlign = 'center'; ctx.textBaseline = 'middle';
  const rashi = window.RASHI_NAMES;
  for(let i=0;i<12;i++){
    const midDeg = i*30 + 15; const aMid = (-midDeg) * Math.PI/180; const rText = (R_outer + R_inner)/2;
    const tx = cx + rText * Math.cos(aMid); const ty = cy + rText * Math.sin(aMid);
    ctx.save(); ctx.translate(tx, ty); ctx.rotate(aMid + Math.PI/2); ctx.fillText(rashi[i], 0, 0); ctx.restore();
    const hx = cx + (R_outer + size*0.06) * Math.cos(aMid); const hy = cy + (R_outer + size*0.06) * Math.sin(aMid);
    ctx.font = Math.max(10, size*0.02) + 'px Arial'; ctx.fillStyle = '#8a4b1c'; ctx.fillText(['I','II','III','IV','V','VI','VII','VIII','IX','X','XI','XII'][i], hx, hy);
    ctx.fillStyle = '#3a1a00';
  }

  // 27 nakshatra annulus
  for(let k=0;k<27;k++){
    const sDeg = k * (360/27); const eDeg = (k+1) * (360/27);
    const a1 = (-sDeg) * Math.PI/180; const a2 = (-eDeg) * Math.PI/180;
    ctx.beginPath(); ctx.arc(cx, cy, N_outer, a1, a2, true); ctx.arc(cx, cy, N_inner, a2, a1, false); ctx.closePath();
    ctx.fillStyle = nakColors[k % nakColors.length]; ctx.fill();
    ctx.beginPath(); ctx.moveTo(cx + N_outer*Math.cos(a2), cy + N_outer*Math.sin(a2)); ctx.lineTo(cx + N_inner*Math.cos(a2), cy + N_inner*Math.sin(a2));
    ctx.strokeStyle = '#000'; ctx.lineWidth = Math.max(1.2, size*0.0035); ctx.stroke();
  }

  // nakshatra labels (radial spoke style, inside inner edge)
  ctx.font = Math.max(9, size*0.016) + 'px Arial'; ctx.fillStyle = '#4b2b00';
  const nak = window.NAK_NAMES;
  for(let k=0;k<27;k++){
    const startDeg = k*(360/27); const endDeg = (k+1)*(360/27); const midDeg = (startDeg + endDeg)/2;
    const aMid = (-midDeg) * Math.PI/180; const labelR = N_inner - size*0.02;
    const lx = cx + labelR * Math.cos(aMid); const ly = cy + labelR * Math.sin(aMid);
    ctx.save(); ctx.translate(lx, ly); ctx.rotate(aMid); ctx.textAlign = 'center'; ctx.fillText(`${nak[k]} ${String(k+1).padStart(2,'0')}`, 0, 0); ctx.restore();
  }

  // center dot
  ctx.beginPath(); ctx.arc(cx,cy,2,0,Math.PI*2); ctx.fillStyle='#6b3e1a'; ctx.fill();

  // planets drawing (RAHU from col24, KETU = RAHU +180, LAGNA special)
  const planets = window.GC_PLANETS || [];
  for(const p of planets){
    let deg;
    if(p.col === 'LAGNA'){
      deg = window.colLAGNA;
    } else if(p.col === 'KETU'){
      const rahuDeg = window.parseAngleGeneric(window['col24'], true);
      if(isNaN(rahuDeg)) { p._pos = null; continue; }
      deg = (rahuDeg + 180) % 360;
    } else {
      const raw = window['col'+p.col];
      deg = window.parseAngleGeneric(raw, p.col===17 || p.col===18);
    }
    if(isNaN(deg)){ p._pos = null; continue; }
    const a = (-deg) * Math.PI/180;
    const px = cx + R_outer * Math.cos(a);
    const py = cy + R_outer * Math.sin(a);
    // ray
    ctx.beginPath(); ctx.moveTo(cx,cy); ctx.lineTo(px,py); ctx.strokeStyle='rgba(80,40,10,0.18)'; ctx.lineWidth=1; ctx.stroke();
    // marker
    ctx.beginPath(); ctx.arc(px,py, Math.max(6, size*0.018), 0, Math.PI*2); ctx.fillStyle = p.color; ctx.fill(); ctx.strokeStyle='#fff'; ctx.lineWidth=1; ctx.stroke();
    // label
    ctx.font = Math.max(10, size*0.018) + 'px Arial'; ctx.fillStyle = '#000'; ctx.textAlign='left';
    ctx.fillText(`${p.label} ${Math.floor(deg)}┬░`, px + size*0.02, py);
    p._pos = { x: px, y: py, deg: deg };
  }

  // attach tooltip (DPI-aware)
  attachTooltip(canvas, planets);
}

/* -------------------- NORTH diamond -------------------- */
function drawNorthKundli(canvas){
  const img = document.getElementById("north_bg");
  if(!img || !canvas) return;

  const dpr = window.devicePixelRatio || 1;
  const size = img.clientWidth;

  canvas.width  = size * dpr;
  canvas.height = size * dpr;
  canvas.style.width  = size + "px";
  canvas.style.height = size + "px";

  const ctx = canvas.getContext("2d");
  ctx.setTransform(dpr,0,0,dpr,0,0);
  ctx.clearRect(0,0,size,size);

  const cx = size/2, cy = size/2;

  // тЬЕ HOUSE COORDS MATCHING YOUR IMAGE EXACTLY (by eye measurement)
  const H = [
    {x:cx,         y:size*0.12},   // H1 top
    {x:size*0.75,  y:size*0.23},   // H2
    {x:size*0.88,  y:cy},          // H3
    {x:size*0.75,  y:size*0.78},   // H4
    {x:cx,         y:size*0.90},   // H5 bottom
    {x:size*0.25,  y:size*0.78},   // H6
    {x:size*0.12,  y:cy},          // H7
    {x:size*0.25,  y:size*0.23},   // H8
    {x:size*0.38,  y:size*0.33},   // H9
    {x:size*0.62,  y:size*0.33},   // H10
    {x:size*0.62,  y:size*0.63},   // H11
    {x:size*0.38,  y:size*0.63}    // H12
  ];

  // тЬЕ Lagna calculation
  let lagnaDeg = Number(window.colLAGNA);
  if(isNaN(lagnaDeg)) lagnaDeg = 0;

  // тЬЕ Planet plotting
  const placed = [];

  GC_PLANETS.forEach(p=>{
    let deg;

    if(p.col==="LAGNA") deg = lagnaDeg;
    else if(p.col==="KETU"){
      const rahu = window.parseAngleGeneric(window.col24,true);
      if(isNaN(rahu)) return;
      deg = (rahu+180)%360;
    }
    else{
      deg = window.parseAngleGeneric(window["col"+p.col], true);
    }

    if(isNaN(deg)) return;

    const offset = ((deg - lagnaDeg) % 360 + 360) % 360;
    const house = Math.floor(offset / 30);
    const pt = H[house];

    // stack if multiple planets
    if(!pt._n) pt._n = 0;
    const dx = (pt._n % 2) * 16;
    const dy = Math.floor(pt._n / 2) * 18;
    pt._n++;

    // draw planet
    ctx.beginPath();
    ctx.arc(pt.x + dx, pt.y + dy, size*0.030, 0, Math.PI*2);
    ctx.fillStyle = p.color;
    ctx.fill();
    ctx.stroke();

    ctx.font = size*0.030 + "px Arial";
    ctx.fillStyle = "#000";
    ctx.fillText(p.label, pt.x + dx - 12, pt.y + dy + size*0.055);

    placed.push({
      label:p.label,
      _pos:{x:pt.x+dx, y:pt.y+dy, deg:deg, house:house+1}
    });
  });

  attachTooltip(canvas, placed);
}

/* -------------------- Render switch and export -------------------- */
function renderCurrentStyle(){
  const style = document.getElementById("gc_style").value;
  const canvas = document.getElementById("gc_canvas");

const bg = document.getElementById("north_bg");

if(style === "south"){
  drawCircularChakra(canvas);
}
else{
  bg.style.display = "block";  // show image
  drawNorthKundli(canvas);
}

}


/* export png */
document.getElementById('gc_export').addEventListener('click', function(){
  const canvas = document.getElementById('gc_canvas');
  // ensure latest render
  renderCurrentStyle();
  const url = canvas.toDataURL('image/png');
  const a = document.createElement('a'); a.href = url; a.download = 'graha_chakra.png'; a.click();
});



/* hide chart */
document.getElementById('gc_hide').addEventListener('click', function(){
  document.getElementById('gc_container').style.display = 'none';
});

/* redraw when style changed */
document.getElementById('gc_style').addEventListener('change', function(){
  renderCurrentStyle();
});

/* Attach hook so searchData triggers chart render (keeps your original pattern) */
(function attachHook(){
  if(typeof window.searchData === 'function' && !window.__graha_circular_hooked){
    const orig = window.searchData;
    window.searchData = function(){
      const r = orig.apply(this, arguments);
      setTimeout(()=>{ try{ document.getElementById('gc_container'); renderCurrentStyle(); }catch(e){} }, 120);
      return r;
    };
    window.__graha_circular_hooked = true;
  } else if(!window.__graha_circular_hooked){
    setTimeout(attachHook, 200);
  }
})();

/* also allow manual quick test if data already present */
setTimeout(()=>{ try{ if(window.col17!==undefined) renderCurrentStyle(); }catch(e){} }, 600);

</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
<script>
document.getElementById("panchangam_export").addEventListener("click", function () {

    const target = document.getElementById("panchangam");

    html2canvas(target, {
        useCORS: true,
        allowTaint: true,
        backgroundColor: null,  // keep transparency
        scale: 2                // HD quality
    }).then(canvas => {
        const link = document.createElement("a");
        link.download = "panchangam.png";
        link.href = canvas.toDataURL("image/png");
        link.click();
    });
});
</script>

</body>
</html>

